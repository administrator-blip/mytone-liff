<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>MYTONE 予約システム</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#5ba88c">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Noto Sans JP フォント -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        /* ========== リセット・ベース ========== */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            height: 100%;
        }

        body {
            font-family: 'Noto Sans JP', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            background: linear-gradient(160deg, #e8f0ec 0%, #f7f5f0 35%, #faf8f5 55%, #f5f0eb 80%, #ede7e0 100%);
            color: #3d4451;
            min-height: 100%;
            padding-bottom: calc(env(safe-area-inset-bottom) + 16px);
        }

        /* ========== ヘッダー ========== */
        .app-header {
            background: linear-gradient(135deg, #2d5a4a 0%, #3d6b5a 20%, #5ba88c 60%, #4d9b80 100%);
            color: #fff;
            padding: 0;
            padding-top: env(safe-area-inset-top);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(45, 90, 74, 0.35), 0 1px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ヘッダー上段: ロゴ+タイトル */
        .header-main {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 16px;
            width: 100%;
            flex-wrap: nowrap;
        }

        /* ヘッダー下段: バッジ情報 */
        .header-sub {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0 16px 8px;
            flex-wrap: wrap;
        }

        .header-sub:empty {
            display: none;
        }

        .app-header .header-title {
            font-size: 1rem;
            font-weight: 800;
            letter-spacing: 0.08em;
            margin: 0;
            white-space: nowrap;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
        }

        /* ========== フォントサイズ切替ボタン ========== */
        .font-toggle {
            position: absolute;
            top: 50%;
            left: 14px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 34px;
            height: 34px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            color: #fff;
            transition: background 0.2s, transform 0.15s;
            backdrop-filter: blur(4px);
        }

        .font-toggle:active {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(0.92);
        }

        .app-header .role-badge {
            display: inline-block;
            font-size: 0.68rem;
            background: rgba(255, 255, 255, 0.18);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            padding: 2px 10px;
            backdrop-filter: blur(4px);
            letter-spacing: 0.03em;
        }

        /* ヘッダーゴールドアクセントライン */
        .header-accent {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #c5a44e 0%, #e8cc6b 30%, #f0d97a 50%, #e8cc6b 70%, #c5a44e 100%);
            box-shadow: 0 1px 6px rgba(197, 164, 78, 0.4);
        }

        /* ========== ロゴ画像 ========== */
        .header-logo {
            height: 36px;
            width: auto;
            vertical-align: middle;
            flex-shrink: 0;
            filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.15));
            transition: transform 0.3s;
            object-fit: contain;
        }

        .header-logo:hover {
            transform: scale(1.05);
        }

        /* ========== 共通 ========== */
        .hidden {
            display: none !important;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 14px 16px;
        }

        /* ========== カード（ガラスモーフィズム） ========== */
        .card {
            background: rgba(255, 255, 255, 0.72);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 14px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.04);
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.25s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 2px 6px rgba(0, 0, 0, 0.06);
        }

        .card-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: #2d5a4a;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(91, 168, 140, 0.18);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title .ct-icon {
            width: 26px;
            height: 26px;
            border-radius: 8px;
            background: linear-gradient(135deg, #e0f2ec, #c8e6d8);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.82rem;
            flex-shrink: 0;
        }

        /* ========== ボタン（リップルエフェクト） ========== */
        .btn {
            position: relative;
            overflow: hidden;
            display: block;
            width: 100%;
            padding: 14px 16px;
            border: none;
            border-radius: 14px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            text-align: center;
            margin-top: 8px;
            transition: transform 0.15s, box-shadow 0.2s;
            letter-spacing: 0.04em;
            font-family: inherit;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .btn:active::after {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn:disabled {
            opacity: 0.45;
            cursor: default;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2d5a4a 0%, #3d6b5a 30%, #5ba88c 80%, #6dbfa3 100%);
            color: #fff;
            box-shadow: 0 4px 16px rgba(45, 90, 74, 0.35);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 24px rgba(45, 90, 74, 0.45);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #546e7a, #78909c);
            color: #fff;
        }

        .btn-danger {
            background: linear-gradient(135deg, #c62828, #e53935);
            color: #fff;
        }

        .btn-outline {
            background: rgba(255, 255, 255, 0.7);
            color: #5ba88c;
            border: 2px solid #5ba88c;
        }

        .btn-small {
            display: inline-block;
            width: auto;
            padding: 8px 14px;
            font-size: 0.82rem;
            margin-top: 6px;
            border-radius: 10px;
        }

        /* ========== フォーム（フローティングラベル） ========== */
        .float-group {
            position: relative;
            margin-top: 18px;
        }

        .float-group label {
            position: absolute;
            left: 14px;
            top: 14px;
            font-size: 0.85rem;
            color: #999;
            font-weight: 500;
            transition: all 0.2s;
            pointer-events: none;
            background: transparent;
            margin: 0;
        }

        .float-group input:focus+label,
        .float-group input:not(:placeholder-shown)+label,
        .float-group textarea:focus+label,
        .float-group textarea:not(:placeholder-shown)+label,
        .float-group select+label,
        .float-group .label-up {
            top: -9px;
            left: 10px;
            font-size: 0.68rem;
            color: #5ba88c;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.9);
            padding: 0 6px;
            border-radius: 4px;
        }

        label {
            display: block;
            font-size: 0.82rem;
            font-weight: 600;
            color: #666;
            margin-top: 14px;
            margin-bottom: 4px;
        }

        input,
        select {
            width: 100%;
            padding: 14px 14px;
            border: 1.5px solid #ddd;
            border-radius: 12px;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.7);
            color: #3d4451;
            appearance: none;
            -webkit-appearance: none;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: inherit;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #5ba88c;
            box-shadow: 0 0 0 3px rgba(91, 168, 140, 0.12);
            background: #fff;
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23666' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 36px;
        }

        /* ========== メッセージ ========== */
        .msg-error {
            background: #fff0f0;
            color: #c62828;
            border-left: 4px solid #e88b8b;
            padding: 10px 12px;
            border-radius: 0 10px 10px 0;
            font-size: 0.88rem;
            margin-top: 8px;
        }

        .msg-success {
            background: #f0f9f4;
            color: #3d6b5a;
            border-left: 4px solid #5ba88c;
            padding: 10px 12px;
            border-radius: 0 10px 10px 0;
            font-size: 0.88rem;
            margin-top: 8px;
        }

        .msg-info {
            background: #f0f4f8;
            border-left: 4px solid #78909c;
            padding: 10px 12px;
            border-radius: 0 10px 10px 0;
            font-size: 0.88rem;
            margin-top: 8px;
            color: #546e7a;
        }

        .msg-warn {
            background: #fdf8ef;
            border-left: 4px solid #e8cc6b;
            padding: 10px 12px;
            border-radius: 0 10px 10px 0;
            font-size: 0.88rem;
            margin-top: 8px;
            color: #8b6914;
        }

        /* ========== ローディング ========== */
        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            gap: 16px;
        }

        .spinner {
            width: 44px;
            height: 44px;
            border: 4px solid #e0f2ec;
            border-top-color: #5ba88c;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            color: #888;
            font-size: 0.9rem;
        }

        /* ========== スプラッシュ画面 ========== */
        .splash-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50vh;
            padding: 40px 20px;
        }

        .splash-logo-text {
            font-size: 1.6rem;
            font-weight: 800;
            color: #3d4451;
            letter-spacing: 0.12em;
            margin-top: 12px;
        }

        .splash-sub {
            font-size: 0.72rem;
            color: #999;
            letter-spacing: 0.08em;
            margin-top: 4px;
        }

        .splash-bar {
            width: 100px;
            height: 3px;
            background: rgba(91, 168, 140, 0.2);
            border-radius: 2px;
            margin-top: 24px;
            overflow: hidden;
        }

        .splash-bar-inner {
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, #5ba88c, #e8cc6b);
            border-radius: 2px;
            animation: splashLoad 1.5s ease-in-out infinite;
        }

        @keyframes splashLoad {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(350%);
            }
        }

        /* ========== タブバー ========== */
        .tab-bar {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            background: rgba(91, 168, 140, 0.08);
            border-radius: 14px;
            padding: 4px;
        }

        .tab-bar .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 11px;
            cursor: pointer;
            font-size: 0.86rem;
            font-weight: 600;
            color: #888;
            transition: all 0.25s;
        }

        .tab-bar .tab.active {
            background: rgba(255, 255, 255, 0.85);
            color: #5ba88c;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        /* ========== ステップインジケーター ========== */
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            padding: 16px 24px 4px;
        }

        .step-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.72rem;
            font-weight: 700;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .step-dot.active {
            background: linear-gradient(135deg, #5ba88c, #6dbfa3);
            color: #fff;
            box-shadow: 0 2px 10px rgba(91, 168, 140, 0.4);
        }

        .step-dot.done {
            background: #5ba88c;
            color: #fff;
        }

        .step-dot.pending {
            background: #e0e0e0;
            color: #999;
        }

        .step-line {
            height: 3px;
            width: 36px;
            background: #e0e0e0;
            border-radius: 2px;
        }

        .step-line.done {
            background: #5ba88c;
        }

        .step-labels {
            display: flex;
            justify-content: space-between;
            padding: 4px 20px 8px;
        }

        .step-label {
            font-size: 0.62rem;
            color: #aaa;
            font-weight: 500;
            text-align: center;
            flex: 1;
        }

        .step-label.active {
            color: #5ba88c;
            font-weight: 700;
        }

        /* ========== スロットボタン ========== */
        .slot-btn {
            display: block;
            width: 100%;
            padding: 12px 14px;
            margin: 6px 0;
            border: 1.5px solid rgba(91, 168, 140, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.6);
            color: #3d6b5a;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-family: inherit;
        }

        .slot-btn:active {
            background: rgba(91, 168, 140, 0.15);
        }

        .slot-btn.selected {
            background: linear-gradient(135deg, #5ba88c, #6dbfa3);
            color: #fff;
            border-color: #5ba88c;
            box-shadow: 0 2px 8px rgba(91, 168, 140, 0.3);
        }

        /* ========== 診断士グループ ========== */
        .diag-group {
            margin-bottom: 14px;
        }

        .diag-group-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: #3d6b5a;
            background: rgba(91, 168, 140, 0.08);
            padding: 6px 10px;
            border-radius: 10px;
            margin-bottom: 6px;
        }

        /* ========== 予約アイテム ========== */
        .booking-item {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 14px;
            padding: 14px 16px;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .booking-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }

        .booking-item .bi-name {
            font-weight: 700;
            font-size: 0.95rem;
            color: #3d4451;
            margin-bottom: 4px;
        }

        .booking-item .bi-step {
            display: inline-block;
            font-size: 0.68rem;
            background: linear-gradient(135deg, #e0f2ec, #c8e6d8);
            color: #3d6b5a;
            border-radius: 6px;
            padding: 2px 8px;
            margin-left: 6px;
            font-weight: 700;
        }

        .booking-item .bi-sub {
            font-size: 0.82rem;
            color: #777;
            margin-top: 3px;
        }

        .booking-item .bi-actions {
            display: flex;
            gap: 6px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .booking-item .bi-actions .btn {
            margin-top: 0;
        }

        /* ========== 稼働枠アイテム ========== */
        .avail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .avail-item:last-child {
            border-bottom: none;
        }

        .avail-time {
            font-size: 0.95rem;
            font-weight: 600;
            color: #3d4451;
        }

        /* ========== 確認詳細 ========== */
        .confirm-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.92rem;
        }

        .confirm-table tr td {
            padding: 8px 4px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .confirm-table tr:last-child td {
            border-bottom: none;
        }

        .confirm-table td:first-child {
            font-weight: 600;
            color: #777;
            width: 5em;
        }

        /* ========== 登録画面 ========== */
        .register-hero {
            text-align: center;
            padding: 20px 0 12px;
        }

        .register-hero .icon {
            font-size: 3rem;
            margin-bottom: 8px;
        }

        /* ========== 日付ナビゲーション ========== */
        .date-nav {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }

        .date-nav input[type="date"] {
            flex: 1;
            margin-top: 0;
        }

        .btn-nav {
            flex-shrink: 0;
            width: 40px;
            height: 46px;
            border: 1.5px solid rgba(91, 168, 140, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.6);
            color: #5ba88c;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.15s;
            font-family: inherit;
        }

        .btn-nav:active {
            background: rgba(91, 168, 140, 0.15);
        }

        /* ========== ボトムシート ========== */
        .sheet-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
            z-index: 200;
            opacity: 0;
            transition: opacity 0.25s;
        }

        .sheet-overlay.show {
            display: block;
            opacity: 1;
        }

        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 22px 22px 0 0;
            padding: 8px 16px calc(env(safe-area-inset-bottom) + 24px);
            box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.15);
            z-index: 201;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 88vh;
            overflow-y: auto;
        }

        .bottom-sheet.show {
            transform: translateY(0);
        }

        .sheet-handle {
            width: 36px;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            margin: 0 auto 14px;
        }

        .sheet-title {
            font-size: 1rem;
            font-weight: 700;
            color: #3d6b5a;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(91, 168, 140, 0.15);
        }

        /* ========== 予約ステータスドット ========== */
        .urgency-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }

        .dot-today {
            background: #e88b8b;
        }

        .dot-tomorrow {
            background: #e8cc6b;
        }

        .dot-week {
            background: #5ba88c;
        }

        .dot-later {
            background: #b0bec5;
        }

        .bi-date-today {
            color: #c75050;
            font-weight: 700;
        }

        .bi-date-tomorrow {
            color: #b8952e;
            font-weight: 600;
        }

        .bi-date-week {
            color: #5ba88c;
        }

        .bi-date-later {
            color: #888;
        }

        /* ========== コピーボタン ========== */
        .btn-copy {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border: 1.5px solid rgba(91, 168, 140, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.6);
            color: #5ba88c;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 6px;
            font-family: inherit;
        }

        .btn-copy:active {
            background: rgba(91, 168, 140, 0.15);
        }

        /* ========== 今日サマリーバー ========== */
        .today-summary {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(91, 168, 140, 0.08);
            border-radius: 14px;
            padding: 12px 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: background 0.15s;
            border: 1px solid rgba(91, 168, 140, 0.1);
        }

        .today-summary:active {
            background: rgba(91, 168, 140, 0.15);
        }

        .today-summary .ts-count {
            font-size: 1.1rem;
            font-weight: 800;
            color: #5ba88c;
        }

        .today-summary .ts-label {
            font-size: 0.85rem;
            color: #777;
            flex: 1;
        }

        /* ========== 店舗名バッジ ========== */
        .salon-badge {
            display: inline-block;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: 0.03em;
            font-weight: 500;
        }

        /* ========== ダークモード トグルボタン ========== */
        .dark-toggle {
            position: absolute;
            top: 50%;
            right: 14px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.12);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1rem;
            cursor: pointer;
            color: #fff;
            transition: background 0.2s;
            backdrop-filter: blur(4px);
        }

        .dark-toggle:active {
            background: rgba(255, 255, 255, 0.25);
        }

        /* ========== スケルトンローディング ========== */
        @keyframes shimmer {
            0% {
                background-position: -400px 0;
            }

            100% {
                background-position: 400px 0;
            }
        }

        .skeleton-item {
            background: linear-gradient(90deg, rgba(91, 168, 140, 0.05) 25%, rgba(91, 168, 140, 0.1) 50%, rgba(91, 168, 140, 0.05) 75%);
            background-size: 400px 100%;
            animation: shimmer 1.4s infinite linear;
            border-radius: 14px;
            height: 84px;
            margin-bottom: 10px;
        }

        .skeleton-line {
            background: linear-gradient(90deg, rgba(91, 168, 140, 0.05) 25%, rgba(91, 168, 140, 0.1) 50%, rgba(91, 168, 140, 0.05) 75%);
            background-size: 400px 100%;
            animation: shimmer 1.4s infinite linear;
            border-radius: 6px;
            height: 14px;
            margin-bottom: 8px;
        }

        .skeleton-line.short {
            width: 55%;
        }

        .skeleton-line.medium {
            width: 75%;
        }



        /* ========== 診断士フィルター ========== */
        .diag-filter-label {
            font-size: 0.8rem;
            color: #777;
            margin-top: 10px;
            margin-bottom: 2px;
        }

        /* ========== 顧客履歴モーダル ========== */
        #historySheet .history-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.88rem;
        }

        #historySheet .history-item:last-child {
            border-bottom: none;
        }

        #historySheet .history-step {
            display: inline-block;
            font-size: 0.72rem;
            padding: 1px 7px;
            border-radius: 10px;
            background: rgba(91, 168, 140, 0.1);
            color: #5ba88c;
            font-weight: 700;
            margin-left: 5px;
        }

        /* ========== 管理統計 ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 14px;
            padding: 14px 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.7rem;
            font-weight: 800;
            color: #5ba88c;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.72rem;
            color: #888;
            margin-top: 4px;
        }

        /* ========== 週間カレンダー ========== */
        .week-cal {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding-bottom: 4px;
            margin-top: 8px;
        }

        .week-day {
            flex-shrink: 0;
            width: 44px;
            border-radius: 12px;
            background: rgba(91, 168, 140, 0.06);
            padding: 10px 4px;
            text-align: center;
            cursor: pointer;
            transition: background 0.15s;
        }

        .week-day:active {
            background: rgba(91, 168, 140, 0.15);
        }

        .week-day .wd-date {
            font-size: 0.8rem;
            color: #888;
        }

        .week-day .wd-dow {
            font-size: 0.95rem;
            font-weight: 700;
            color: #5ba88c;
        }

        .week-day .wd-slots {
            font-size: 0.75rem;
            color: #6dbfa3;
            margin-top: 3px;
        }

        .week-day.wd-today {
            background: rgba(91, 168, 140, 0.15);
            border: 2px solid #5ba88c;
        }

        .week-day.wd-selected {
            background: linear-gradient(135deg, #5ba88c, #6dbfa3);
        }

        .week-day.wd-selected .wd-dow,
        .week-day.wd-selected .wd-date,
        .week-day.wd-selected .wd-slots {
            color: #fff;
        }

        /* 稼働可能マーク */
        .wd-avail-mark {
            font-size: 0.7rem;
            font-weight: 700;
            color: #5ba88c;
            margin-top: 2px;
            line-height: 1;
        }

        .week-day.wd-selected .wd-avail-mark {
            color: #fff;
        }

        .wd-avail-time {
            font-size: 0.55rem;
            color: #999;
            margin-top: 1px;
            line-height: 1.3;
            word-break: break-all;
            white-space: normal;
            text-align: center;
        }

        .week-day.wd-selected .wd-avail-time {
            color: rgba(255, 255, 255, 0.85);
        }

        body.dark .wd-avail-mark {
            color: #7cc9a8;
        }

        body.dark .wd-avail-time {
            color: #aaa;
        }

        /* ========== LINEプレビュー ========== */
        .line-preview {
            background: #06c755;
            border-radius: 14px;
            padding: 10px 12px;
            margin-top: 10px;
            color: #fff;
            font-size: 0.82rem;
            line-height: 1.6;
        }

        .line-preview-label {
            font-size: 0.72rem;
            color: #888;
            margin-top: 10px;
            margin-bottom: 2px;
            font-weight: 600;
        }

        /* ========== 再試行ボタン ========== */
        .btn-retry {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 14px;
            border: 1.5px solid #e88b8b;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.7);
            color: #c75050;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            font-family: inherit;
        }

        .btn-retry:active {
            background: #fff0f0;
        }

        /* ========== メモ欄 ========== */
        .memo-area {
            width: 100%;
            min-height: 50px;
            max-height: 100px;
            padding: 10px 12px;
            border: 1.5px solid #ddd;
            border-radius: 12px;
            font-size: 0.9rem;
            resize: vertical;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.7);
            color: #3d4451;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .memo-area:focus {
            border-color: #5ba88c;
            box-shadow: 0 0 0 3px rgba(91, 168, 140, 0.12);
            outline: none;
        }

        .bi-memo {
            font-size: 0.78rem;
            color: #888;
            margin-top: 4px;
            white-space: pre-wrap;
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 6px;
        }

        /* ========== フィルタバー ========== */
        .filter-bar {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 6px 14px;
            border-radius: 20px;
            border: 1.5px solid rgba(91, 168, 140, 0.3);
            background: rgba(255, 255, 255, 0.6);
            color: #5ba88c;
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .filter-chip.active {
            background: linear-gradient(135deg, #5ba88c, #6dbfa3);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(91, 168, 140, 0.3);
        }

        .sort-btn {
            margin-left: auto;
            padding: 6px 12px;
            border-radius: 20px;
            border: 1.5px solid #ddd;
            background: rgba(255, 255, 255, 0.6);
            color: #777;
            font-size: 0.76rem;
            cursor: pointer;
            font-family: inherit;
        }

        /* ========== 長押しメニュー ========== */
        .ctx-menu {
            position: fixed;
            z-index: 2000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.18);
            min-width: 180px;
            padding: 6px 0;
            display: none;
        }

        .ctx-menu.show {
            display: block;
            animation: fadeScale 0.15s ease;
        }

        @keyframes fadeScale {
            from {
                opacity: 0;
                transform: scale(0.92);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .ctx-item {
            display: block;
            width: 100%;
            padding: 12px 18px;
            border: none;
            background: none;
            text-align: left;
            font-size: 0.88rem;
            cursor: pointer;
            color: #3d4451;
            font-family: inherit;
            transition: background 0.15s;
        }

        .ctx-item:active {
            background: rgba(91, 168, 140, 0.08);
        }

        .ctx-item.danger {
            color: #c75050;
        }

        .ctx-overlay {
            position: fixed;
            inset: 0;
            z-index: 1999;
            display: none;
        }

        .ctx-overlay.show {
            display: block;
        }

        /* ========== フォントサイズ切替（位置上書き） ========== */
        .font-toggle {
            right: 52px;
            left: auto;
        }

        body.font-lg {
            font-size: 18px !important;
        }

        body.font-lg .card-title {
            font-size: 1.05rem;
        }

        body.font-lg .bi-sub {
            font-size: 0.88rem;
        }

        /* ========== Confetti アニメーション ========== */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .confetti-piece {
            position: absolute;
            top: -20px;
            width: 10px;
            height: 10px;
            border-radius: 2px;
            animation: confettiFall 1.8s ease-in forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* ========== 稼働枠カレンダー（診断士） ========== */
        .avail-cal {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 12px;
        }

        .avail-cal-head {
            text-align: center;
            font-size: 0.82rem;
            font-weight: 700;
            color: #888;
            padding: 6px 0;
        }

        .avail-cal-cell {
            text-align: center;
            padding: 8px 2px;
            border-radius: 10px;
            font-size: 0.88rem;
            background: rgba(0, 0, 0, 0.02);
            min-height: 48px;
        }

        .avail-cal-cell.has-avail {
            background: rgba(91, 168, 140, 0.15);
            font-weight: 700;
            color: #3d6b5a;
        }

        .avail-cal-cell.today {
            border: 2px solid #5ba88c;
        }

        .avail-cal-cell .ac-count {
            font-size: 0.78rem;
            color: #fff;
            background: #5ba88c;
            border-radius: 10px;
            padding: 1px 6px;
            display: inline-block;
            margin-top: 2px;
        }

        .avail-cal-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .avail-cal-nav span {
            font-weight: 700;
            font-size: 0.95rem;
        }

        /* ========== 診断士ダッシュボード ========== */
        .dash-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .dash-stat-card {
            text-align: center;
            padding: 14px 8px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(91, 168, 140, 0.1), rgba(91, 168, 140, 0.05));
        }

        .dash-stat-num {
            font-size: 1.6rem;
            font-weight: 800;
            color: #3d6b5a;
        }

        .dash-stat-label {
            font-size: 0.72rem;
            color: #888;
            margin-top: 2px;
        }

        .dash-booking {
            padding: 12px 14px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(91, 168, 140, 0.12);
            margin-bottom: 10px;
        }

        .dash-booking-date {
            font-size: 0.82rem;
            font-weight: 700;
            color: #5ba88c;
        }

        .dash-booking-info {
            font-size: 0.85rem;
            color: #3d4451;
            margin-top: 4px;
        }

        .dash-booking-status {
            display: inline-block;
            font-size: 0.72rem;
            font-weight: 600;
            padding: 2px 10px;
            border-radius: 20px;
            margin-top: 6px;
        }

        .dash-booking-status.confirmed {
            background: rgba(46, 125, 50, 0.12);
            color: #2e7d32;
        }

        .dash-booking-status.changed {
            background: rgba(245, 124, 0, 0.12);
            color: #e65100;
        }

        .dash-booking-status.canceled {
            background: rgba(198, 40, 40, 0.12);
            color: #c62828;
        }

        .dash-section-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: #3d6b5a;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 2px solid rgba(91, 168, 140, 0.15);
        }

        /* ========== オフラインバナー ========== */
        .offline-banner {
            background: linear-gradient(135deg, #e8cc6b, #d4b85c);
            color: #3d4451;
            text-align: center;
            padding: 8px;
            font-size: 0.82rem;
            font-weight: 600;
            display: none;
        }

        .offline-banner.show {
            display: block;
        }


        /* ========== 空状態 ========== */
        .empty-state {
            text-align: center;
            padding: 32px 20px;
        }

        .empty-illustration {
            width: 100px;
            height: 100px;
            margin: 0 auto 16px;
            background: linear-gradient(160deg, #e0f2ec, rgba(232, 204, 107, 0.15));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.8rem;
        }

        .empty-state h3 {
            font-size: 0.95rem;
            color: #777;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .empty-state p {
            font-size: 0.8rem;
            color: #aaa;
        }

        /* ========== ページ遷移アニメーション ========== */
        .page-enter {
            animation: slideIn 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(24px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* ========== レスポンシブ: タブレット/PC 2カラム ========== */
        @media (min-width: 768px) {
            .container {
                max-width: 760px;
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            #staffList .card:has(#bookingsList) {
                display: block;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 960px;
            }

            body {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .app-header {
                max-width: 100%;
            }
        }

        /* ========== ダークモード: OS設定連動 ========== */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(160deg, #1a1a1a 0%, #121212 50%, #181818 100%);
                color: #e0e0e0;
            }

            .card {
                background: rgba(40, 40, 40, 0.7);
                border-color: rgba(255, 255, 255, 0.06);
                box-shadow: none;
            }

            input,
            select,
            textarea {
                background: rgba(40, 40, 40, 0.7);
                border-color: rgba(255, 255, 255, 0.12);
                color: #e0e0e0;
            }

            .tab-bar {
                background: rgba(40, 40, 40, 0.5);
            }

            .tab {
                color: #888;
            }

            .tab.active {
                color: #7cc9a8;
                background: rgba(60, 60, 60, 0.8);
            }

            .booking-item {
                background: rgba(40, 40, 40, 0.6);
                border-color: rgba(255, 255, 255, 0.06);
            }

            .bi-name {
                color: #e0e0e0;
            }

            .bi-sub {
                color: #aaa;
            }

            .slot-btn {
                background: rgba(40, 40, 40, 0.7);
                border-color: rgba(255, 255, 255, 0.1);
                color: #e0e0e0;
            }

            .slot-btn.selected {
                background: linear-gradient(135deg, #3d6b5a, #5ba88c);
                border-color: #5ba88c;
            }

            .diag-group-title {
                background: rgba(91, 168, 140, 0.1);
                color: #7cc9a8;
            }

            .today-summary {
                background: rgba(91, 168, 140, 0.08);
            }

            .today-summary .ts-count {
                color: #7cc9a8;
            }

            .skeleton-item,
            .skeleton-line {
                background: linear-gradient(90deg, #2c2c2c 25%, #383838 50%, #2c2c2c 75%);
            }

            .bottom-sheet {
                background: rgba(30, 30, 30, 0.95);
            }

            .stat-card {
                background: rgba(40, 40, 40, 0.7);
                border-color: rgba(255, 255, 255, 0.06);
            }

            .stat-value {
                color: #7cc9a8;
            }

            .week-day {
                background: rgba(91, 168, 140, 0.08);
            }

            .week-day.wd-today {
                border-color: #7cc9a8;
                background: rgba(91, 168, 140, 0.12);
            }

            .card-title {
                color: #7cc9a8;
                border-bottom-color: rgba(124, 201, 168, 0.15);
            }
        }

        /* ========== ダークモード: 手動トグル ========== */
        body.dark {
            background: linear-gradient(160deg, #1a1a1a 0%, #121212 50%, #181818 100%);
            color: #e0e0e0;
        }

        body.dark .card {
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.06);
            box-shadow: none;
        }

        body.dark input,
        body.dark select {
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.12);
            color: #e0e0e0;
        }

        body.dark .tab-bar {
            background: rgba(40, 40, 40, 0.5);
        }

        body.dark .tab {
            color: #888;
        }

        body.dark .tab.active {
            color: #7cc9a8;
            background: rgba(60, 60, 60, 0.8);
        }

        body.dark .booking-item {
            background: rgba(40, 40, 40, 0.6);
            border-color: rgba(255, 255, 255, 0.06);
        }

        body.dark .bi-name {
            color: #e0e0e0;
        }

        body.dark .bi-sub {
            color: #aaa;
        }

        body.dark .slot-btn {
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        body.dark .slot-btn.selected {
            background: linear-gradient(135deg, #3d6b5a, #5ba88c);
            border-color: #5ba88c;
        }

        body.dark .diag-group-title {
            background: rgba(91, 168, 140, 0.1);
            color: #7cc9a8;
        }

        body.dark .today-summary {
            background: rgba(91, 168, 140, 0.08);
        }

        body.dark .skeleton-item,
        body.dark .skeleton-line {
            background: linear-gradient(90deg, #2c2c2c 25%, #383838 50%, #2c2c2c 75%);
            background-size: 400px 100%;
            animation: shimmer 1.4s infinite linear;
        }

        body.dark .bottom-sheet {
            background: rgba(30, 30, 30, 0.95);
        }

        body.dark .stat-card {
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.06);
        }

        body.dark .stat-value {
            color: #7cc9a8;
        }

        body.dark .week-day {
            background: rgba(91, 168, 140, 0.08);
        }

        body.dark .week-day.wd-today {
            border-color: #7cc9a8;
            background: rgba(91, 168, 140, 0.12);
        }

        body.dark .card-title {
            color: #7cc9a8;
            border-bottom-color: rgba(124, 201, 168, 0.15);
        }

        body.dark .sheet-title {
            color: #7cc9a8;
            border-bottom-color: rgba(124, 201, 168, 0.15);
        }

        body.dark .memo-area {
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.12);
            color: #e0e0e0;
        }

        body.dark .filter-chip {
            background: rgba(40, 40, 40, 0.6);
            border-color: rgba(124, 201, 168, 0.2);
            color: #7cc9a8;
        }

        body.dark .filter-chip.active {
            background: linear-gradient(135deg, #3d6b5a, #5ba88c);
            color: #fff;
        }

        body.dark .sort-btn {
            background: rgba(40, 40, 40, 0.6);
            border-color: rgba(255, 255, 255, 0.1);
            color: #999;
        }

        body.dark .ctx-menu {
            background: rgba(40, 40, 40, 0.95);
        }

        body.dark .ctx-item {
            color: #e0e0e0;
        }

        body.dark .ctx-item:active {
            background: rgba(91, 168, 140, 0.1);
        }

        body.dark .avail-cal-cell {
            background: rgba(40, 40, 40, 0.5);
            color: #ccc;
        }

        body.dark .avail-cal-cell.has-avail {
            background: rgba(91, 168, 140, 0.15);
            color: #7cc9a8;
        }

        body.dark .msg-success {
            background: rgba(91, 168, 140, 0.1);
            color: #7cc9a8;
            border-left-color: #5ba88c;
        }

        body.dark .msg-error {
            background: rgba(232, 139, 139, 0.1);
            color: #e88b8b;
            border-left-color: #e88b8b;
        }

        body.dark .msg-info {
            background: rgba(120, 144, 156, 0.1);
            color: #b0bec5;
            border-left-color: #78909c;
        }

        body.dark .fab {
            background: linear-gradient(135deg, #3d6b5a, #5ba88c);
        }

        /* ========== FABボタン ========== */
        .fab {
            position: fixed;
            right: 20px;
            bottom: calc(env(safe-area-inset-bottom) + 20px);
            width: 54px;
            height: 54px;
            border-radius: 50%;
            background: linear-gradient(135deg, #5ba88c, #3d6b5a);
            color: #fff;
            font-size: 1.4rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(91, 168, 140, 0.5);
            z-index: 150;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .fab:active {
            transform: scale(0.9);
        }

        /* ========== スプラッシュフェードアウト ========== */
        @keyframes splashFadeOut {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        .splash-hiding {
            animation: splashFadeOut 0.6s ease forwards;
        }

        /* ========== タブレット2カラム ========== */
        @media (min-width: 768px) {
            .container {
                max-width: 900px;
                padding: 18px 28px;
            }

            #screenStaff,
            #screenDiag {
                max-width: 900px;
                margin: 0 auto;
                padding: 18px 28px;
            }

            .card {
                border-radius: 22px;
            }
        }
    </style>
</head>

<body>
    <!-- ========== ヘッダー ========== -->
    <div class="app-header" style="position:relative">
        <!-- 上段: ロゴ + タイトル -->
        <div class="header-main">
            <h1 class="header-title">MYTONE 予約システム</h1>
        </div>
        <!-- 下段: バッジ情報 -->
        <div class="header-sub">
            <div id="salonBadge" class="salon-badge hidden"></div>
            <div id="roleBadge" class="role-badge hidden"></div>
        </div>
        <button class="font-toggle" onclick="toggleFontSize()">Aa</button>
        <button class="dark-toggle" onclick="toggleDarkMode()">&#127769;</button>
        <div class="header-accent"></div>
    </div>
    <!-- オフラインバナー -->
    <div id="offlineBanner" class="offline-banner">⚠️ オフラインです。最後に取得したデータを表示しています。</div>

    <!--==========スプラッシュ画面==========-->
    <div id="screenSplash"
        style="position:fixed;inset:0;background:linear-gradient(160deg,#e8f0ec 0%,#f7f5f0 35%,#faf8f5 55%,#f5f0eb 80%,#ede7e0 100%);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center">
        <img src="data:image/png;base64,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"
            alt="MYTONE" width="180"
            style="height:auto;max-width:60vw;filter:drop-shadow(0 4px 12px rgba(0,0,0,0.12));object-fit:contain">
        <div
            style="font-size:2rem;font-weight:900;letter-spacing:0.18em;margin-top:20px;font-family:'Noto Sans JP',sans-serif;background:linear-gradient(135deg,#3d6b5a 0%,#5ba88c 40%,#c5a44e 70%,#e8cc6b 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">
            MY TONE</div>
        <div
            style="font-size:0.75rem;color:#777;letter-spacing:0.12em;margin-top:6px;font-family:'Noto Sans JP',sans-serif;font-weight:500">
            マイトーン予約システム</div>
        <div
            style="font-size:0.6rem;color:#b0a898;letter-spacing:0.2em;margin-top:3px;font-family:'Noto Sans JP',sans-serif;text-transform:uppercase;font-weight:500">
            beauty salon reservation</div>
        <div
            style="width:120px;height:3px;background:rgba(91,168,140,0.15);border-radius:2px;margin-top:30px;overflow:hidden">
            <div
                style="width:40%;height:100%;background:linear-gradient(90deg,#5ba88c,#c5a44e,#e8cc6b);border-radius:2px;animation:splashLoad 1.5s ease-in-out infinite">
            </div>
        </div>
    </div>




    <!--==========初期化中==========-->
    <div id="screenLoading" class="container">
        <div class="loading-screen">
            <div class="spinner"></div>
            <div class="loading-text">&#35501;
                &#12415;
                &#36796;
                &#12415;
                &#20013;
                ...</div>
        </div>
    </div>
    <!--==========未登録画面==========-->
    <div id="screenRegister" class="container hidden">
        <div class="register-hero">
            <div class="icon">👤</div>
            <p>美容室スタッフまたは診断士として<br>ご登録ください</p>
        </div>
        <div class="card">
            <div class="tab-bar">
                <div class="tab active" onclick="switchRegTab('staff')">スタッフ登録</div>
                <div class="tab" onclick="switchRegTab('diag')">診断士登録</div>
            </div>
            <div id="regStaff"><label>店舗コード</label><input id="regSalonCode" placeholder="例: S00001"
                    autocomplete="off"><button class="btn btn-primary" onclick="doLinkSalon()">登録する</button>
            </div>
            <div id="regDiag" class="hidden"><label>診断士ID</label><input id="regDiagId" placeholder="例: D00001"
                    autocomplete="off"><button class="btn btn-primary" onclick="doLinkDiag()">登録する</button>
            </div>
            <div id="regMsg"></div>
        </div>
    </div>
    <!--==========スタッフ画面==========-->
    <div id="screenStaff" class="container hidden">
        <div class="tab-bar" id="staffTabs">
            <div class="tab active" onclick="switchStaffTab('new')">新規予約</div>
            <div class="tab" onclick="switchStaffTab('list')">予約一覧</div>
        </div>
        <!-- 新規予約 -->
        <div id="staffNew">
            <!-- 今日のサマリーバー -->
            <div id="todaySummary" class="today-summary hidden" onclick="switchStaffTab('list')">
                <span>📅</span><span class="ts-count" id="todayCount">0</span><span class="ts-label">本日の予約 › 一覧へ</span>
            </div>
            <!-- Step種別選択 -->
            <div class="card" id="stepSelect">
                <div class="card-title">予約種別を選択</div><button class="btn btn-primary" onclick="startStep('STEP1')">📋
                    STEP1 初回診断</button><button class="btn btn-outline" onclick="startStep2Search()"
                    style="margin-top:10px">🔄 STEP2 フォロー診断</button>
            </div>
            <!-- STEP2: 親STEP1検索 -->
            <div class="card hidden" id="step2ParentSearch">
                <div class="card-title">STEP2: 親 STEP1 を検索</div>
                <label>顧客電話番号</label><input id="s2Phone" type="tel" placeholder="09012345678"><button
                    class="btn btn-primary" onclick="doFindParent()">検索</button>
                <div id="s2ParentList"></div>
                <div id="s2Msg"></div><button class="btn btn-outline" onclick="resetNewBooking()"
                    style="margin-top:10px">←
                    戻る</button>
            </div>
            <!-- 顧客情報入力 -->
            <div class="card hidden" id="custInfo">
                <div class="card-title" id="custStepLabel"></div><label>顧客名
                    <span style="color:#e53935">*</span></label><input id="custName" placeholder="山田 太郎"><label>電話番号
                    <span style="color:#e53935">*</span></label><input id="custPhone" type="tel"
                    placeholder="09012345678">
                <!-- 過去顧客名オートフィル提案 -->
                <div id="custNameSuggest" class="hidden" style="margin-top:4px">
                </div>
                <label>性別</label><select id="custGender">
                    <option value="">未選択</option>
                    <option>男性</option>
                    <option>女性</option>
                    <option>その他</option>
                </select><label>年齢</label><input id="custAge" type="number" placeholder="30" min="0"
                    max="120"><label>メモ（任意）</label><textarea id="custMemo" class="memo-area"
                    placeholder="例: カラー希望、前回の相談内容など"></textarea><button class="btn btn-primary"
                    onclick="goToDateInput()" style="margin-top:14px">次へ: 日にち選択 →</button><button
                    class="btn btn-outline" onclick="resetNewBooking()" style="margin-top:8px">← 戻る</button><button
                    class="btn btn-secondary" onclick="doViewHistory()" style="margin-top:8px;font-size:0.82rem">📞
                    過去の予約を確認</button>
            </div>
            <!-- 日付入力＋空き検索 -->
            <div class="card hidden" id="dateSearch">
                <div class="card-title">日にち指定・空き検索</div>
                <!-- 週間カレンダー -->
                <div class="diag-filter-label">&#128197;
                    週間ビュー（タップで日付選択）</div>
                <div class="week-cal" id="weekCalArea"></div><label style="margin-top:12px">基準日</label>
                <div class="date-nav"><button class="btn-nav" onclick="shiftDate('searchDate',-1)">&#9668;
                    </button><input id="searchDate" type="date"><button class="btn-nav"
                        onclick="shiftDate('searchDate',1)">&#9658;
                    </button></div>
                <!-- 診断士を指名して検索 -->
                <div class="diag-filter-label">&#128104;
                    &#8205;
                    &#9877;
                    &#65039;
                    診断士を指定（任意）</div><select id="diagFilter" style="margin-bottom:0">
                    <option value="">&#9675;
                        指定なし（全員対象）</option>
                </select><button class="btn btn-primary" onclick="doSearchSlots()" style="margin-top:14px">&#128269;
                    空きを検索</button>
                <div id="slotsArea" style="margin-top:12px">
                </div><button class="btn btn-secondary hidden" id="btnFallback" onclick="doSearchFallback()"
                    style="margin-top:8px">別の診断士でも探す</button>
            </div>
            <!-- 確認画面（ボトムシート内に移動) -->
        </div>
        <!-- 予約一覧 -->
        <div id="staffList" class="hidden">
            <!-- 管理者統計カード -->
            <div class="card" id="adminStats" style="margin-bottom:10px">
                <div class="card-title">📊 今月のサマリー</div>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-value" id="statToday">-</div>
                        <div class="stat-label">本日の予約</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statWeek">-</div>
                        <div class="stat-label">今週の予約</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statMonth">-</div>
                        <div class="stat-label">今月の予約</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statTotal">-</div>
                        <div class="stat-label">最終確定済</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">予約一覧（本日以降）</div>
                <div class="filter-bar"><button class="filter-chip active"
                        onclick="setFilter('all',this)">全件</button><button class="filter-chip"
                        onclick="setFilter('confirmed',this)">✅
                        確定</button><button class="filter-chip" onclick="setFilter('changed',this)">🔄
                        変更済</button><button class="filter-chip" onclick="setFilter('canceled',this)">❌
                        キャンセル</button><button class="sort-btn" onclick="toggleSort()" id="sortBtn">▲ 日付順</button></div>
                <label>電話番号で絞り込み（任意）</label><input id="listPhone" type="tel"
                    placeholder="09012345678"><label>顧客名で絞り込み（任意）</label><input id="listName" type="text"
                    placeholder="山田 太郎"><button class="btn btn-secondary" onclick="doListBookings()"
                    style="margin-top:10px">🔍 検索</button>
                <div id="bookingsList" style="margin-top:12px"></div>
            </div>
            <!-- 変更エリア -->
            <div class="card hidden" id="changeArea">
                <div class="card-title">予約変更</div>
                <div id="changeInfo" class="msg-info"></div>
                <label>新しい基準日</label>
                <div class="date-nav"><button class="btn-nav" onclick="shiftDate('changeDate',-1)">◄</button><input
                        id="changeDate" type="date"><button class="btn-nav"
                        onclick="shiftDate('changeDate',1)">►</button></div>
                <button class="btn btn-primary" onclick="doSearchChangeSlots()" style="margin-top:10px">🔍
                    空きを検索</button>
                <div id="changeSlotsArea" style="margin-top:12px"></div><button class="btn btn-primary hidden"
                    id="btnConfirmChange" onclick="doConfirmChange()" style="margin-top:8px">この日時に変更する</button><button
                    class="btn btn-outline" onclick="closeChangeArea()" style="margin-top:8px">キャンセル</button>
                <div id="changeMsg"></div>
            </div>
        </div>
    </div>
    <!--==========診断士画面==========-->
    <div id="screenDiag" class="container hidden">
        <div class="tab-bar" id="diagTabs">
            <div class="tab active" onclick="switchDiagTab('add')">稼働枠追加</div>
            <div class="tab" onclick="switchDiagTab('list')">稼働枠一覧</div>
            <div class="tab" onclick="switchDiagTab('dash')">📊 ダッシュボード</div>
        </div>
        <div id="diagAdd">
            <div class="card">
                <div class="card-title">稼働枠を追加</div><label>日付</label><input id="availDate"
                    type="date"><label>開始時刻（30分刻み）</label><select
                    id="availTime"></select><label>ブロック数（1ブロック=130分）</label><select id="availBlocks">
                    <option value="1">1ブロック（130分）</option>
                    <option value="2">2ブロック（260分）</option>
                    <option value="3">3ブロック（390分）</option>
                </select>
                <!-- 繰り返し登録オプション --><label style="margin-top:10px">🔄 繰り返し登録</label><select id="availRepeat">
                    <option value="0">繰り返しなし（一回のみ）</option>
                    <option value="1">1週間繰り返す（2回）</option>
                    <option value="2">2週間繰り返す（3回）</option>
                    <option value="3">3週間繰り返す（4回）</option>
                    <option value="4">4週間繰り返す（5回）</option>
                </select><button class="btn btn-primary" onclick="doCreateAvail()" style="margin-top:14px">➕
                    稼働枠を作成</button>
                <div id="availMsg"></div>
            </div>
        </div>
        <div id="diagList" class="hidden">
            <div class="card">
                <div class="card-title">稼働枠一覧</div>
                <!-- 稼働枠カレンダービュー -->
                <div class="avail-cal-nav"><button class="btn-nav" onclick="shiftAvailCalMonth(-1)">◄</button><span
                        id="availCalTitle"></span><button class="btn-nav" onclick="shiftAvailCalMonth(1)">►</button>
                </div>
                <div id="availCalGrid" class="avail-cal"></div><button class="btn btn-secondary"
                    onclick="doListAvail()">🔄 一覧更新</button>
                <div id="availList" style="margin-top:12px"></div>
            </div>
        </div>
        <div id="diagDash" class="hidden">
            <div class="card">
                <div class="card-title">📊 予約ダッシュボード</div>
                <div class="dash-stats">
                    <div class="dash-stat-card">
                        <div class="dash-stat-num" id="dashToday">-</div>
                        <div class="dash-stat-label">今日</div>
                    </div>
                    <div class="dash-stat-card">
                        <div class="dash-stat-num" id="dashWeek">-</div>
                        <div class="dash-stat-label">今週</div>
                    </div>
                    <div class="dash-stat-card">
                        <div class="dash-stat-num" id="dashTotal">-</div>
                        <div class="dash-stat-label">全件</div>
                    </div>
                </div>
                <div class="dash-section-title">📅 今後の予約一覧</div>
                <div id="diagBookingsList"></div>
                <button class="btn btn-secondary" onclick="loadDiagDashboard()" style="margin-top:10px">🔄 更新</button>
            </div>
        </div>
    </div>
    <!--==========オーバーレイ+ボトムシート==========-->
    <div id="sheetOverlay" class="sheet-overlay" onclick="closeConfirmSheet()"></div>
    <div id="confirmSheet" class="bottom-sheet">
        <div class="sheet-handle"></div>
        <div class="sheet-title">予約内容の確認</div>
        <div id="sheetConfirmDetail"></div>
        <!-- LINE通知プレビュー -->
        <div class="line-preview-label">📱 診断士へのLINE通知プレビュー</div>
        <div id="linePreviewBox" class="line-preview">…</div><button class="btn btn-primary" onclick="doCreateBooking()"
            style="margin-top:14px">✅ 予約を確定する</button><button class="btn btn-outline" onclick="closeConfirmSheet()"
            style="margin-top:8px">←
            戻る</button>
        <div id="sheetConfirmMsg"></div>
    </div>
    <!-- 顧客履歴ボトムシート -->
    <div id="historyOverlay" class="sheet-overlay" onclick="closeHistorySheet()">
    </div>
    <div id="historySheet" class="bottom-sheet">
        <div class="sheet-handle"></div>
        <div class="sheet-title">📞 顧客履歴</div>
        <div id="historyContent">
            <div class="loading-text" style="text-align:center;padding:20px">読込中...
            </div>
        </div>
    </div>
    <script>

        /* ========== グローバル状態 ========== */
        const STATE = {

            line_user_id: '',
            role: '',
            salon_id: '',
            diag_id: '',
            step_type: '',
            parent_booking_id: '',
            preferred_diag_id: '',
            customer: {}

            ,
            selectedSlot: null,
            selectedDiagId: '',
            selectedDiagName: '',
            changeBookingId: '',
            changeSlot: null,
        }

            ;

        /* ========== 設定: ここだけ変更する ========== */
        // LINE Developers Console の LIFF ID
        const LIFF_ID = '2009132853-rlGuhhMj';
        // GAS デプロイURL（デプロイを管理 → ウェブアプリURL）
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyJ6RasshdyfQVueQvWu58MIS-ILVXDwxiK-6m4lmCmhV28m_ebOOhwhWLL36yW3JJ-mg/exec';

        // LIFF SDK を複数CDNからフォールバック付きで動的読み込み
        function loadSdk(urls, onSuccess, onFail) {
            if (urls.length === 0) {
                onFail();
                return;
            }

            var s = document.createElement('script');
            s.src = urls[0];
            s.onload = onSuccess;

            s.onerror = function () {
                loadSdk(urls.slice(1), onSuccess, onFail);
            }

                ;
            document.head.appendChild(s);
        }

        document.addEventListener('DOMContentLoaded', function () {
            showStep('LIFF SDK 読み込み中...');
            loadSdk(['https://cdn.jsdelivr.net/npm/@line/liff@2.22.3/dist/liff.min.js',
                'https://unpkg.com/@line/liff@2.22.3/dist/liff.min.js',
                'https://static.line-scdn.net/liff/edge/2/sdk.js'

            ],
                function () {
                    if (typeof liff === 'undefined') {
                        showStep('⚠️ LIFF SDKが読み込まれていません。ページを再読み込みしてください。', true);
                        return;
                    }

                    initLiff();
                }

                ,
                function () {
                    showStep('⚠️ LIFF SDKの読み込みに失敗しました。ネットワークを確認してください。', true);
                });
        });

        // ローディング画面にステップメッセージを表示
        function showStep(msg, isError) {
            const cls = isError ? 'msg-error' : 'loading-text';
            el('screenLoading').innerHTML = '<div class="loading-screen">'
                + (isError ? '' : '<div class="spinner"></div>') + '<div class="' + cls + '" style="text-align:center;padding:0 16px">' + msg + '</div>'
                + '</div>';
        }

        async function initLiff() {

            // タイムアウト付き Promise
            function withTimeout(promise, ms, label) {
                return Promise.race([promise,
                    new Promise((_, reject) => setTimeout(() => reject(new Error(label + ' が ' + (ms / 1000) + '秒以内に完了しませんでした')), ms))]);
            }

            try {
                // STEP 1: LIFF_ID 確認
                showStep('ステップ 1/4: LIFF ID 確認中...');
                console.log('LIFF_ID:', LIFF_ID);

                if (!LIFF_ID || LIFF_ID === '') {
                    showStep('⚠️ LIFF IDが設定されていません。GASスクリプトプロパティ「LIFF_ID」を確認してください。', true);
                    return;
                }

                // STEP 2: liff.init()
                const liffIdTrimmed = LIFF_ID.trim();
                showStep('ステップ 2/4: LIFF 初期化中... (ID: ' + liffIdTrimmed + ' [len:' + liffIdTrimmed.length + '])');

                try {
                    await liff.init({
                        liffId: liffIdTrimmed
                    });
                }

                catch (initErr) {
                    // init失敗時: エラーコードとURL詳細を表示
                    const baseUrl = location.href.split('?')[0].split('#')[0];
                    const errCode = initErr.code || initErr.errorCode || 'N/A';
                    showStep('⚠️ LIFF初期化失敗<br>'
                        + 'メッセージ: ' + (initErr.message || String(initErr)) + '<br>'
                        + 'コード: ' + errCode + '<br>'
                        + 'ベースURL: <small style="word-break:break-all">' + baseUrl + '</small>',
                        true);
                    return;
                }

                // STEP 3: ログイン確認
                showStep('ステップ 3/4: ログイン状態確認中...');

                if (!liff.isLoggedIn()) {
                    showStep('ユーザーログイン処理中...');
                    liff.login();
                    return;
                }

                // STEP 4: プロフィール取得
                showStep('ステップ 4/4: プロフィール取得中...');
                const profile = await withTimeout(liff.getProfile(),
                    10000,
                    'liff.getProfile()'
                );
                STATE.line_user_id = profile.userId;
                console.log('line_user_id:', STATE.line_user_id.substring(0, 6) + '...');

                showStep('サーバーに接続中...');
                bootstrap();
            }

            catch (e) {
                console.error('LIFF init error:', e);
                showStep('⚠️ 初期化エラー: ' + (e.message || String(e)), true);
            }
        }

        /* ========== Bootstrap ========== */
        function bootstrap() {
            showStep('サーバーからユーザー情報を取得中...');

            // apiBootstrap のタイムアウト
            const timer = setTimeout(function () {
                showStep('⚠️ サーバーからの応答がタイムアウトしました (15秒)。ページを再読み込みしてください。', true);
            }

                , 15000);

            callApi('apiBootstrap', {
                line_user_id: STATE.line_user_id
            }

                , (res) => {
                    clearTimeout(timer);
                    hide('screenLoading');

                    if (!res.ok) {
                        showFatalError(res.error); return;
                    }

                    STATE.role = res.role;

                    if (res.role === 'staff') {
                        STATE.salon_id = res.salon_id;
                        setBadge('スタッフ');

                        // 店舗名バッジ表示
                        if (res.salon_name) {
                            const sb = el('salonBadge');
                            sb.textContent = '🏪 ' + res.salon_name;
                            sb.classList.remove('hidden');
                        }

                        show('screenStaff');
                        initStaffUI();

                        // 今日の予約件数（GASが返す場合のみ表示）
                        if (res.today_count !== undefined && res.today_count > 0) {
                            el('todayCount').textContent = res.today_count + '件';
                            show('todaySummary');
                        }
                    }

                    else if (res.role === 'diagnostician') {
                        STATE.diag_id = res.diag_id;
                        setBadge('診断士');
                        show('screenDiag');
                        initDiagUI();
                    }

                    else {
                        show('screenRegister');
                    }
                });
        }

        function setBadge(label) {
            const b = el('roleBadge');
            b.textContent = label;
            b.classList.remove('hidden');
        }

        function showFatalError(msg) {
            el('screenLoading').innerHTML = `<div class="container"><div class="msg-error" style="margin-top:40px">⚠️ ${esc(msg)
                }

            </div></div>`;
            show('screenLoading');
        }

        /* ========== 登録画面 ========== */
        function switchRegTab(tab) {
            const tabs = document.querySelectorAll('#screenRegister .tab');
            tabs.forEach(t => t.classList.remove('active'));

            if (tab === 'staff') {
                tabs[0].classList.add('active');
                show('regStaff');
                hide('regDiag');
            }

            else {
                tabs[1].classList.add('active');
                hide('regStaff');
                show('regDiag');
            }

            el('regMsg').innerHTML = '';
        }

        function doLinkSalon() {
            const code = el('regSalonCode').value.trim();

            if (!code) {
                el('regMsg').innerHTML = '<div class="msg-error">店舗コードを入力してください</div>';
                return;
            }

            el('regMsg').innerHTML = '<div class="loading-text" style="text-align:center;padding:10px">登録中...</div>';

            callApi('apiLinkSalon', {
                line_user_id: STATE.line_user_id, salon_code: code
            }

                , (res) => {
                    if (!res.ok) {
                        el('regMsg').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                    }

                    STATE.role = 'staff'; STATE.salon_id = res.salon_id;
                    setBadge('スタッフ');
                    hide('screenRegister'); show('screenStaff');
                    initStaffUI();
                    el('regMsg').innerHTML = '';

                    showToast(res.salon_name + ' のスタッフとして登録しました ✅');
                });
        }

        function doLinkDiag() {
            const id = el('regDiagId').value.trim();

            if (!id) {
                el('regMsg').innerHTML = '<div class="msg-error">診断士IDを入力してください</div>';
                return;
            }

            el('regMsg').innerHTML = '<div class="loading-text" style="text-align:center;padding:10px">登録中...</div>';

            callApi('apiLinkDiagnostician', {
                line_user_id: STATE.line_user_id, diag_id: id
            }

                , (res) => {
                    if (!res.ok) {
                        el('regMsg').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                    }

                    STATE.role = 'diagnostician'; STATE.diag_id = res.diag_id;
                    setBadge('診断士');
                    hide('screenRegister'); show('screenDiag');
                    initDiagUI();
                    el('regMsg').innerHTML = '';

                    showToast(res.diag_name + ' として登録しました ✅');
                });
        }

        /* ========== スタッフUI ========== */
        function initStaffUI() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            el('searchDate').value = fmtDate(tomorrow);
            el('changeDate').value = fmtDate(tomorrow);

            // 電話番号入力フィールドの自動整形（数字のみ許可）
            ['custPhone',
                's2Phone',
                'listPhone'].forEach(function (id) {
                    var inp = el(id);

                    if (inp) inp.addEventListener('input', function () {
                        var v = this.value.replace(/\D/g, '');
                        if (this.value !== v) this.value = v;
                    });
                });

            // custPhone: 入力後に過去顧客名を検索してオートフィル提案
            el('custPhone').addEventListener('change', function () {
                const phone = this.value.trim();
                const suggestEl = el('custNameSuggest');

                if (!phone || phone.length < 7) {
                    hide('custNameSuggest'); return;
                }

                callApi('apiFindCustomerByPhone', {
                    line_user_id: STATE.line_user_id, customer_phone: phone
                }

                    , (res) => {
                        if (!res.ok || !res.customer_name) {
                            hide('custNameSuggest'); return;
                        }

                        // 顧客名フィールドが空のときのみ提案
                        if (el('custName').value.trim()) {
                            hide('custNameSuggest'); return;
                        }

                        suggestEl.innerHTML = ` <div class="msg-info" style="display:flex;align-items:center;gap:8px;padding:8px 10px;" > <span style="flex:1" >💡 過去の顧客: <strong>${esc(res.customer_name)
                            }

                        </strong></span> <button class="btn-copy" onclick="el('custName').value='${esc(res.customer_name)}';hide('custNameSuggest')" >使う</button> </div>`;
                        show('custNameSuggest');
                    });
            });
            // 診断士リスト読込 + 週間カレンダー描画 + プルトゥリフレッシュ
            loadDiagList();
            renderWeekCal();

            // 基準日変更時に週間カレンダーを連動
            el('searchDate').addEventListener('change', function () {
                renderWeekCal();
            });

            resetNewBooking();
        }

        function switchStaffTab(tab) {
            const tabs = document.querySelectorAll('#staffTabs .tab');
            tabs.forEach(t => t.classList.remove('active'));

            if (tab === 'new') {
                tabs[0].classList.add('active');
                show('staffNew');
                hide('staffList');
            }

            else {
                tabs[1].classList.add('active');
                hide('staffNew');
                show('staffList');
                doListBookings();
                doAdminStats(); // 統計更新
            }
        }

        /* --- 新規予約フロー --- */
        function resetNewBooking() {
            STATE.step_type = '';
            STATE.parent_booking_id = '';
            STATE.preferred_diag_id = '';

            STATE.customer = {}

                ;
            STATE.selectedSlot = null;
            STATE.selectedDiagId = '';
            STATE.selectedDiagName = '';
            closeConfirmSheet();
            show('stepSelect');
            hide('step2ParentSearch');
            hide('custInfo');
            hide('dateSearch');
            el('slotsArea').innerHTML = '';
            hide('btnFallback');
        }

        function startStep(step) {
            STATE.step_type = step;
            STATE.parent_booking_id = '';
            STATE.preferred_diag_id = '';
            hide('stepSelect');
            show('custInfo');
            el('custStepLabel').textContent = step === 'STEP1' ? '📋 STEP1 初回診断' : '🔄 STEP2 フォロー診断';
            el('custName').value = '';
            el('custPhone').value = '';
            el('custGender').value = '';
            el('custAge').value = '';
            // メモ欄もリセット
            if (el('custMemo')) el('custMemo').value = '';
        }

        function startStep2Search() {
            STATE.step_type = 'STEP2';
            hide('stepSelect');
            show('step2ParentSearch');
            el('s2Phone').value = '';
            el('s2ParentList').innerHTML = '';
            el('s2Msg').innerHTML = '';
        }

        function doFindParent() {
            const phone = el('s2Phone').value.trim();

            if (!phone) {
                el('s2Msg').innerHTML = '<div class="msg-error">電話番号を入力してください</div>';
                return;
            }

            el('s2Msg').innerHTML = '<div class="loading-text" style="text-align:center;padding:10px">検索中...</div>';

            callApi('apiFindParentStep1', {
                line_user_id: STATE.line_user_id, customer_phone: phone
            }

                , (res) => {
                    el('s2Msg').innerHTML = '';

                    if (!res.ok) {
                        el('s2Msg').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                    }

                    if (res.parents.length === 0) {
                        el('s2ParentList').innerHTML = '<div class="msg-warn">該当するSTEP1が見つかりません</div>';
                        return;
                    }

                    let h = '<p style="font-size:.85rem;color:#555;margin:8px 0 4px">親STEP1を選択してください:</p>';

                    for (const p of res.parents) {
                        const dt = fmtDt(p.start_at);

                        h += `<button class="slot-btn" onclick="selectParent('${esc(p.booking_id)}','${esc(p.diag_id)}','${esc(p.customer_name)}','${esc(p.customer_phone)}')" >` + `👤 ${esc(p.customer_name)
                            }

                    / ${dt
                            }

                    <br><small style="font-weight:normal" >診断士: ${esc(p.diag_name)
                            }

                    </small></button>`;
                    }

                    el('s2ParentList').innerHTML = h;
                });
        }

        function selectParent(bookingId, diagId, custName, custPhone) {
            STATE.parent_booking_id = bookingId;
            STATE.preferred_diag_id = diagId;
            hide('step2ParentSearch');
            show('custInfo');
            el('custStepLabel').textContent = '🔄 STEP2 フォロー診断（同一診断士優先）';
            el('custName').value = custName;
            el('custPhone').value = custPhone;
        }

        function goToDateInput() {
            const name = el('custName').value.trim();
            const phone = el('custPhone').value.trim();

            if (!name || !phone) {
                showToast('顧客名と電話番号は必須です', true);
                return;
            }

            STATE.customer = {
                name,
                phone,
                gender: el('custGender').value,
                age: el('custAge').value
            }

                ;
            hide('custInfo');
            show('dateSearch');
            el('slotsArea').innerHTML = '';
            hide('btnFallback');
        }

        function doSearchSlots() {
            const ymd = el('searchDate').value;

            if (!ymd) {
                showToast('基準日を選択してください', true);
                return;
            }

            showSkeleton('slotsArea', 3);
            hide('btnFallback');
            const diagFilter = el('diagFilter') ? el('diagFilter').value : '';

            const payload = {
                line_user_id: STATE.line_user_id,
                step_type: STATE.step_type,
                date_ymd: ymd,
                parent_booking_id: STATE.parent_booking_id || '',
                allow_fallback: false,
                diag_id_filter: diagFilter,
            }

                ;

            callApi('apiSearchSlots', payload, (res) => {
                if (!res.ok) {
                    el('slotsArea').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                }

                if (res.mode === 'no_preferred_slot') {
                    el('slotsArea').innerHTML = '<div class="msg-warn">同一診断士の空きがありません</div>';
                    show('btnFallback');
                    return;
                }

                renderSlots(res.results, 'slotsArea');

                if (res.results.length === 0) {
                    el('slotsArea').innerHTML = '<div class="msg-warn">空きがありません。別の日付をお試しください。</div>';
                }
            });
        }

        function doSearchFallback() {
            const ymd = el('searchDate').value;
            el('slotsArea').innerHTML = '<div class="loading-text" style="text-align:center;padding:16px"><div class="spinner" style="margin:0 auto 8px"></div>検索中...</div>';
            hide('btnFallback');

            const payload = {
                line_user_id: STATE.line_user_id,
                step_type: STATE.step_type,
                date_ymd: ymd,
                parent_booking_id: STATE.parent_booking_id || '',
                allow_fallback: true,
            }

                ;

            callApi('apiSearchSlots', payload, (res) => {
                if (!res.ok) {
                    el('slotsArea').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                }

                renderSlots(res.results, 'slotsArea');

                if (res.results.length === 0) {
                    el('slotsArea').innerHTML = '<div class="msg-warn">空きがありません。</div>';
                }
            });
        }

        function renderSlots(results, targetId) {
            // 素時数が1件以上ある場合のみ内訳バナーを表示
            let totalSlots = results.reduce((s, g) => s + g.slots.length, 0);
            let h = '';
            if (totalSlots > 0) {
                h += `<div style="
                    background: linear-gradient(135deg, rgba(91,168,140,0.10) 0%, rgba(197,164,78,0.08) 100%);
                    border: 1px solid rgba(91,168,140,0.30);
                    border-radius: 12px;
                    padding: 10px 14px;
                    margin-bottom: 10px;
                    font-size: 0.82rem;
                    color: #3d6b5a;
                    line-height: 1.6;
                ">
                    <div style="font-weight:700;margin-bottom:4px;font-size:0.88rem">⏰ 予約時間について</div>
                    <div>下記の時間は「予約枠」（<b>130分</b>）の開始時刻です。</div>
                    <div style="margin-top:4px;display:flex;gap:8px;flex-wrap:wrap">
                        <span style="background:rgba(91,168,140,0.15);border-radius:6px;padding:2px 8px">&#9986;&#65039; 施術 <b>70分</b></span>
                        <span style="color:#aaa">&#43;</span>
                        <span style="background:rgba(197,164,78,0.15);border-radius:6px;padding:2px 8px">🚗 診断士移動 <b>60分</b></span>
                        <span style="color:#aaa">=</span>
                        <span style="background:rgba(61,107,90,0.12);border-radius:6px;padding:2px 8px;font-weight:700">合計 130分</span>
                    </div>
                </div>`;
            }

            for (const group of results) {
                h += `<div class="diag-group"><div class="diag-group-title">👨‍⚕️ ${esc(group.diag_name)
                    }

                </div>`;

                for (const s of group.slots) {
                    const lbl = fmtDt(s.start_at) + ' 〜 ' + fmtTime(s.end_at);

                    h += `<button class="slot-btn" data-iso="${esc(s.start_at)}" data-did="${esc(group.diag_id)}" data-dn="${esc(group.diag_name)}" onclick="pickSlot(this)">🕐 ${lbl
                        }

                    <br><small style="font-weight:normal;opacity:0.75">施術70分 + 移動60分含む</small></button>`;
                }

                h += '</div>';
            }

            el(targetId).innerHTML = h;
        }

        function pickSlot(btn) {
            document.querySelectorAll('#slotsArea .slot-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            STATE.selectedSlot = btn.dataset.iso;
            STATE.selectedDiagId = btn.dataset.did;
            STATE.selectedDiagName = btn.dataset.dn;
            const dt = fmtDt(STATE.selectedSlot);

            el('sheetConfirmDetail').innerHTML = ` <table class="confirm-table"><tr><td>種別</td><td>${esc(STATE.step_type)
                }

            </td></tr><tr><td>顧客名</td><td>${esc(STATE.customer.name)
                }

            </td></tr><tr><td>電話</td><td>${esc(STATE.customer.phone)
                }

            </td></tr><tr><td>診断士</td><td>${esc(STATE.selectedDiagName)
                }

            </td></tr><tr><td>開始時刻</td><td>${dt
                }

            </td></tr><tr><td style="white-space:nowrap">予約枠</td><td><span style="font-size:0.82rem;color:#5ba88c">施術 70分 + 診断士移動 60分 = <b>130分確保</b></span></td></tr></table>`;
            el('sheetConfirmMsg').innerHTML = '';
            openConfirmSheet();
            updateLinePreview(); // LINE通知プレビュー更新
        }

        function backToSlots() {
            closeConfirmSheet();
            STATE.selectedSlot = null;
        }

        function doCreateBooking() {
            if (!STATE.selectedSlot) {
                showToast('枚を選択してください', true);
                return;
            }

            el('sheetConfirmMsg').innerHTML = '<div class="loading-text" style="text-align:center;padding:10px">予約作成中...</div>';

            const payload = {
                line_user_id: STATE.line_user_id,
                step_type: STATE.step_type,
                parent_booking_id: STATE.parent_booking_id || '',
                customer_name: STATE.customer.name,
                customer_phone: STATE.customer.phone,
                gender: STATE.customer.gender || '',
                age: STATE.customer.age || '',
                memo: el('custMemo') ? el('custMemo').value.trim() : '',
                diag_id: STATE.selectedDiagId,
                start_at_iso: STATE.selectedSlot,
            }

                ;

            callApi('apiCreateBooking', payload, (res) => {
                if (!res.ok) {
                    el('sheetConfirmMsg').innerHTML = `<div class="msg-error" >${esc(res.error)
                        }

                        </div> <button class="btn-retry" onclick="doCreateBooking()" >🔄 再試行</button>`;
                    return;
                }

                // 成功: ハプティクス + confetti + コピーボタン表示
                if (navigator.vibrate) navigator.vibrate([50, 30, 50]);
                showConfetti();
                const bid = res.booking.booking_id;

                el('sheetConfirmMsg').innerHTML = ` <div class="msg-success" > ✅ 予約確定: <strong>${esc(bid)
                    }

                    </strong><br> <button class="btn-copy" onclick="copyId('${esc(bid)}')" >&#128203; 予約IDをコピー</button> <small style="display:block;color:#2e7d32;margin-top:4px" >診断士へ通知済 📩</small> </div>`;

                setTimeout(() => {
                    closeConfirmSheet(); resetNewBooking();
                }

                    , 3500);
            });
        }

        /* --- 予約一覧 --- */
        function doListBookings() {
            const phone = el('listPhone').value.trim();
            const nameQ = el('listName') ? el('listName').value.trim() : '';
            showSkeleton('bookingsList', 3);

            callApi('apiListBookings', {
                line_user_id: STATE.line_user_id, q_phone: phone, q_name: nameQ
            }

                , (res) => {
                    if (!res.ok) {
                        el('bookingsList').innerHTML = `<div class="msg-error" >${esc(res.error)
                            }

                    </div> <button class="btn-retry" onclick="doListBookings()" >🔄 再試行</button>`;
                        return;
                    }

                    // キャッシュ保存（オフライン用）
                    _cachedBookings = res.bookings || [];

                    try {
                        localStorage.setItem('mytone_bookings_cache', JSON.stringify(_cachedBookings));
                    }

                    catch (e) { }

                    // フィルタ＆ソートして描画
                    renderFilteredBookings();
                });
        }

        /* --- 変更フロー --- */
        function openChange(bookingId) {
            STATE.changeBookingId = bookingId;
            STATE.changeSlot = null;
            show('changeArea');

            el('changeInfo').textContent = `変更対象: ${bookingId
                }

            `;
            el('changeSlotsArea').innerHTML = '';
            hide('btnConfirmChange');
            el('changeMsg').innerHTML = '';

            el('changeArea').scrollIntoView({
                behavior: 'smooth', block: 'start'
            });
        }

        function closeChangeArea() {
            hide('changeArea');
            STATE.changeBookingId = '';
        }

        function doSearchChangeSlots() {
            const ymd = el('changeDate').value;

            if (!ymd) {
                showToast('日付を選択してください', true);
                return;
            }

            el('changeSlotsArea').innerHTML = '<div class="loading-text" style="text-align:center;padding:16px"><div class="spinner" style="margin:0 auto 8px"></div>検索中...</div>';
            hide('btnConfirmChange');

            callApi('apiSearchSlotsForChange', {
                line_user_id: STATE.line_user_id,
                booking_id: STATE.changeBookingId,
                date_ymd: ymd,
            }

                , (res) => {
                    if (!res.ok) {
                        el('changeSlotsArea').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                    }

                    if (res.results.length === 0) {
                        el('changeSlotsArea').innerHTML = '<div class="msg-warn">空きがありません</div>';
                        return;
                    }

                    renderChangeSlots(res.results);
                });
        }

        function renderChangeSlots(results) {
            let h = '';

            for (const group of results) {
                h += `<div class="diag-group"><div class="diag-group-title">👨‍⚕️ ${esc(group.diag_name)
                    }

                </div>`;

                for (const s of group.slots) {
                    const lbl = fmtDt(s.start_at) + ' 〜 ' + fmtTime(s.end_at);

                    h += `<button class="slot-btn" data-iso="${esc(s.start_at)}" onclick="pickChangeSlot(this)">🕐 ${lbl
                        }

                    </button>`;
                }

                h += '</div>';
            }

            el('changeSlotsArea').innerHTML = h;
        }

        function pickChangeSlot(btn) {
            document.querySelectorAll('#changeSlotsArea .slot-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            STATE.changeSlot = btn.dataset.iso;
            show('btnConfirmChange');
        }

        function doConfirmChange() {
            if (!STATE.changeSlot) return;
            el('changeMsg').innerHTML = '<div class="loading-text" style="text-align:center;padding:10px">変更中...</div>';

            callApi('apiChangeBooking', {
                line_user_id: STATE.line_user_id,
                booking_id: STATE.changeBookingId,
                new_start_at_iso: STATE.changeSlot,
            }

                , (res) => {
                    if (!res.ok) {
                        el('changeMsg').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                    }

                    el('changeMsg').innerHTML = `<div class="msg-success" >✅ 変更完了: ${esc(res.booking.booking_id)
                        }

                </div>`;

                    setTimeout(() => {
                        closeChangeArea(); doListBookings();
                    }

                        , 2000);
                });
        }

        /* --- キャンセル --- */
        function doCancel(bookingId) {
            if (!confirm(`予約 ${bookingId
                }

                    をキャンセルしますか？`)) return;

            callApi('apiCancelBooking', {
                line_user_id: STATE.line_user_id, booking_id: bookingId
            }

                , (res) => {
                    if (!res.ok) {
                        showToast(res.error, true); return;
                    }

                    if (navigator.vibrate) navigator.vibrate(80);
                    showToast('キャンセルしました');
                    doListBookings();
                });
        }

        /* ========== 日付ナビゲーション ========== */
        function shiftDate(inputId, days) {
            const inp = el(inputId);

            if (!inp.value) {
                const d = new Date();
                d.setDate(d.getDate() + 1);
                inp.value = fmtDate(d);
            }

            const d = new Date(inp.value + 'T00:00:00');
            d.setDate(d.getDate() + days);
            inp.value = fmtDate(d);

            // 基準日(searchDate)変更時は週間カレンダーを連動
            if (inputId === 'searchDate') {
                renderWeekCal();
            }
        }

        /* ========== ボトムシート制御 ========== */
        function openConfirmSheet() {
            el('sheetOverlay').classList.add('show');
            requestAnimationFrame(() => el('confirmSheet').classList.add('show'));
            document.body.style.overflow = 'hidden';
        }

        function closeConfirmSheet() {
            el('sheetOverlay').classList.remove('show');
            el('confirmSheet').classList.remove('show');
            document.body.style.overflow = '';
        }

        /* ========== 予約IDコピー ========== */
        function copyId(id) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(id).then(() => showToast('コピーしました: ' + id));
            }

            else {
                const ta = document.createElement('textarea');
                ta.value = id;
                ta.style.position = 'fixed';
                ta.style.opacity = '0';
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                showToast('コピーしました: ' + id);
            }
        }

        /* ========== 一覧からSTEP2フロー開始 ========== */
        function startStep2FromBooking(bookingId, diagId, custName, custPhone) {
            switchStaffTab('new');
            STATE.step_type = 'STEP2';
            STATE.parent_booking_id = bookingId;
            STATE.preferred_diag_id = diagId;
            hide('stepSelect');
            show('custInfo');
            el('custStepLabel').textContent = '&#x1f504; STEP2 \u30d5\u30a9\u30ed\u30fc\u8a3a\u65ad\uff08\u540c\u4e00\u8a3a\u65ad\u58eb\u512a\u5148\uff09';
            el('custName').value = custName;
            el('custPhone').value = custPhone;
        }

        /* ========== \u30c0\u30fc\u30af\u30e2\u30fc\u30c9 ========== */
        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            localStorage.setItem('mytone_dark', isDark ? '1' : '0');
        }

        // \u8d77\u52d5\u6642\u306b\u8a2d\u5b9a\u3092\u5fa9\u5143
        (function () {
            if (localStorage.getItem('mytone_dark') === '1') document.body.classList.add('dark');
        })();

        /* ========== \u30b9\u30b1\u30eb\u30c8\u30f3\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0 ========== */
        function showSkeleton(targetId, count) {
            count = count || 3;
            var h = '';

            for (var i = 0; i < count; i++) {
                h += '<div class="skeleton-item"><div style="padding:12px"><div class="skeleton-line medium"></div><div class="skeleton-line short"></div></div></div>';
            }

            el(targetId).innerHTML = h;
        }



        /* ========== 週間カレンダービュー ========== */
        // デバウンス用タイマーとAPIキャッシュ
        let _weekCalTimer = null;
        let _weekAvailCache = {}; // キー: base_date, 値: resデータ

        function renderWeekCal() {
            // 連続呼び出し時は200ms待って最後の1回だけ実行
            clearTimeout(_weekCalTimer);
            _weekCalTimer = setTimeout(_doRenderWeekCal, 200);
        }

        function _doRenderWeekCal() {
            const calEl = el('weekCalArea');
            if (!calEl) return;
            const today = new Date();
            const todayStr = fmtDate(today);
            const DOW = ['日', '月', '火', '水', '木', '金', '土'];
            const curVal = el('searchDate') ? el('searchDate').value : '';

            // 基準日を中心に前3日〜後3日の7日間を表示
            let baseDate;
            if (curVal) {
                baseDate = new Date(curVal + 'T00:00:00');
            } else {
                baseDate = new Date(today);
            }
            const baseDateStr = fmtDate(baseDate);

            let h = '';
            for (let i = -3; i <= 3; i++) {
                const d = new Date(baseDate);
                d.setDate(baseDate.getDate() + i);
                const ymd = fmtDate(d);
                const isSel = curVal === ymd;
                const isToday = ymd === todayStr;

                h += `<div class="week-day${isToday ? ' wd-today' : ''}${isSel ? ' wd-selected' : ''}" data-ymd="${ymd}" onclick="if(el('searchDate'))el('searchDate').value='${ymd}';renderWeekCal()">`;
                h += `<div class="wd-date">${d.getMonth() + 1}/${d.getDate()}</div>`;
                h += `<div class="wd-dow">${DOW[d.getDay()]}</div>`;
                h += `<div class="wd-slots" id="wdSlot_${ymd}">&nbsp;</div>`;
                h += `</div>`;
            }

            calEl.innerHTML = h;

            // キャッシュがあればそのまま使用（同じ基準日なら再取得しない）
            if (STATE.line_user_id && STATE.role === 'staff') {
                if (_weekAvailCache[baseDateStr]) {
                    _applyWeekAvail(_weekAvailCache[baseDateStr]);
                } else {
                    callApi('apiWeekAvailSummary', {
                        line_user_id: STATE.line_user_id,
                        base_date: baseDateStr
                    }, function (res) {
                        if (!res.ok || !res.days) return;
                        _weekAvailCache[baseDateStr] = res;
                        _applyWeekAvail(res);
                    });
                }
            }
        }

        function _applyWeekAvail(res) {
            res.days.forEach(function (day) {
                const slotEl = document.getElementById('wdSlot_' + day.date);
                if (!slotEl) return;
                if (day.has_avail) {
                    let markHtml = '<div class="wd-avail-mark">○</div>';
                    if (day.summary) {
                        const summaryHtml = esc(day.summary).replace(/〜/g, '<br>');
                        markHtml += '<div class="wd-avail-time">' + summaryHtml + '</div>';
                    }
                    slotEl.innerHTML = markHtml;
                } else {
                    slotEl.innerHTML = '<div style="font-size:0.6rem;color:#ccc">—</div>';
                }
            });
        }

        /* ========== 診断士リスト読込 ========== */
        function loadDiagList() {
            const sel = el('diagFilter');
            if (!sel) return;

            callApi('apiGetDiagList', {
                line_user_id: STATE.line_user_id
            }

                , (res) => {
                    if (!res.ok || !res.diags) return;
                    // innerHTML+= を配列join化（DOM再解析を廃止）
                    const opts = ['<option value="">\u25cb \u6307\u5b9a\u306a\u3057\uff08\u5168\u54e1\u5bfe\u8c61\uff09</option>'];
                    res.diags.forEach(d => {
                        opts.push(`<option value="${esc(d.diag_id)}">${esc(d.diag_name)}</option>`);
                    });
                    sel.innerHTML = opts.join('');
                });
        }

        /* ========== LINE\u901a\u77e5\u30d7\u30ec\u30d3\u30e5\u30fc ========== */
        function updateLinePreview() {
            const box = el('linePreviewBox');
            if (!box || !STATE.selectedSlot) return;
            const dt = fmtDt(STATE.selectedSlot);
            box.innerHTML = `\u3010MYTONE\u4e88\u7d04\u304a\u77e5\u3089\u305b\u3011<br>\u65b0\u3057\u3044\u4e88\u7d04\u304c\u5165\u308a\u307e\u3057\u305f&#x1f4c5;

            <br>\u9867\u5ba2\u540d: ${esc(STATE.customer.name || '')
                }

            <br>\u7a2e\u5225: ${esc(STATE.step_type)
                }

            <br>\u65e5\u6642: ${dt
                }

            <br>\u8a3a\u65ad\u58eb: ${esc(STATE.selectedDiagName)
                }

            <br><small>\u203b\u8a73\u7d30\u306f\u30b7\u30b9\u30c6\u30e0\u3067\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044</small>`;
        }

        /* ========== \u9867\u5ba2\u5c65\u6b74\u30b7\u30fc\u30c8 ========== */
        function doViewHistory() {
            const phone = el('custPhone').value.trim();

            if (!phone) {
                showToast('\u5148\u306b\u96fb\u8a71\u756a\u53f7\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044', true);
                return;
            }

            el('historyContent').innerHTML = '<div class="loading-text" style="text-align:center;padding:20px"><div class="spinner" style="margin:0 auto 8px"></div>\u8aad\u8fbc\u4e2d...</div>';
            openHistorySheet();

            callApi('apiGetCustomerHistory', {
                line_user_id: STATE.line_user_id, customer_phone: phone
            }

                , (res) => {
                    if (!res.ok) {
                        el('historyContent').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                    }

                    if (!res.bookings || res.bookings.length === 0) {
                        el('historyContent').innerHTML = '<div class="msg-info">\u904e\u53bb\u306e\u4e88\u7d04\u306f\u3042\u308a\u307e\u305b\u3093</div>';
                        return;
                    }

                    let h = `<p style="font-size:.8rem;color:#666;margin-bottom:8px" >\ud83d\udcde ${esc(phone)
                        }

                </p>`;

                    for (const b of res.bookings) {
                        const col = b.status === 'CONFIRMED' || b.status === 'CHANGED' ? '#2e7d32' : b.status === 'CANCELED' ? '#c62828' : '#888';

                        h += `<div class="history-item" >\n ${fmtDt(b.start_at)
                            }

                    <span class="history-step" >${esc(b.step_type)
                            }

                    </span><br>\n <span style="color:#555" >\ud83d\udc68\u200d\u2695\ufe0f ${esc(b.diag_name)
                            }

                    </span>\n <span style="float:right;font-size:.75rem;color:${col}" >${esc(b.status)
                            }

                    </span>\n</div>`;
                    }

                    el('historyContent').innerHTML = h;
                });
        }

        function openHistorySheet() {
            el('historyOverlay').classList.add('show');
            requestAnimationFrame(() => el('historySheet').classList.add('show'));
            document.body.style.overflow = 'hidden';
        }

        function closeHistorySheet() {
            el('historyOverlay').classList.remove('show');
            el('historySheet').classList.remove('show');
            document.body.style.overflow = '';
        }

        /* ========== \u7ba1\u7406\u8005\u7d71\u8a08 ========== */
        function doAdminStats() {

            ['statToday',
                'statWeek',
                'statMonth',
                'statTotal'].forEach(id => {
                    const e = el(id); if (e) e.textContent = '\u2026';
                });

            callApi('apiAdminStats', {
                line_user_id: STATE.line_user_id
            }

                , (res) => {
                    if (!res.ok) return;
                    if (el('statToday')) el('statToday').textContent = res.today ?? '-';
                    if (el('statWeek')) el('statWeek').textContent = res.week ?? '-';
                    if (el('statMonth')) el('statMonth').textContent = res.month ?? '-';
                    if (el('statTotal')) el('statTotal').textContent = res.total ?? '-';
                });
        }

        /* ========== \u30a8\u30e9\u30fc\u6642\u306e\u518d\u8a66\u884c\u30dc\u30bf\u30f3\u8868\u793a ========== */
        function showRetryError(targetId, msg, fn, payload, cb) {
            const retryJson = JSON.stringify({
                fn, payload

            }).replace(/"/g, '&quot;');
            el(targetId).innerHTML = `<div class="msg-error" >${esc(msg)
                }

            </div> <button class="btn-retry" onclick='var d=JSON.parse(this.dataset.r);callApi(d.fn,d.payload,function(r){if(!r.ok){showRetryError("${targetId}",r.error,d.fn,d.payload,null);}else{el("${targetId}").innerHTML="";}}' data-r="${retryJson}" >\ud83d\udd04 \u518d\u8a66\u884c</button>`;
        }

        /* ========== 診断士UI ========== */
        function initDiagUI() {
            const sel = el('availTime');
            // innerHTML+= を配列join化（毎ループのDOM再解析を廃止）
            const opts = [];
            for (let h = 7; h <= 21; h++) {
                for (const m of ['00', '30']) {
                    const v = String(h).padStart(2, '0') + ':' + m;
                    opts.push('<option value="' + v + '">' + v + '</option>');
                }
            }
            sel.innerHTML = opts.join('');

            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            el('availDate').value = fmtDate(tomorrow);
        }

        function switchDiagTab(tab) {
            const tabs = document.querySelectorAll('#diagTabs .tab');
            tabs.forEach(t => t.classList.remove('active'));

            if (tab === 'add') {
                tabs[0].classList.add('active');
                show('diagAdd'); hide('diagList'); hide('diagDash');
            } else if (tab === 'list') {
                tabs[1].classList.add('active');
                hide('diagAdd'); show('diagList'); hide('diagDash');
                doListAvail();
            } else if (tab === 'dash') {
                tabs[2].classList.add('active');
                hide('diagAdd'); hide('diagList'); show('diagDash');
                loadDiagDashboard();
            }
        }

        /* ========== 診断士ダッシュボード ========== */
        function loadDiagDashboard() {
            el('diagBookingsList').innerHTML = '<div class="loading-text" style="text-align:center;padding:16px"><div class="spinner" style="margin:0 auto 8px"></div>読込中...</div>';

            callApi('apiListBookings', {
                line_user_id: STATE.line_user_id, q_phone: '', q_name: ''
            }, (res) => {
                if (!res.ok) {
                    el('diagBookingsList').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>';
                    return;
                }

                // 診断士IDでフィルタリング
                const myBookings = (res.bookings || []).filter(b => b.diag_id === STATE.diag_id && b.status !== 'CANCELED');
                const now = new Date();
                const todayStr = fmtDate(now);

                // 今週末の日付を計算
                const weekEnd = new Date(now);
                weekEnd.setDate(now.getDate() + (7 - now.getDay()));
                const weekEndStr = fmtDate(weekEnd);

                // 統計計算
                let todayCount = 0, weekCount = 0;
                myBookings.forEach(b => {
                    const bDate = b.start_at ? b.start_at.substring(0, 10) : '';
                    if (bDate === todayStr) todayCount++;
                    if (bDate >= todayStr && bDate <= weekEndStr) weekCount++;
                });

                el('dashToday').textContent = todayCount;
                el('dashWeek').textContent = weekCount;
                el('dashTotal').textContent = myBookings.length;

                // 予約リスト表示（日付順）
                const sorted = myBookings.sort((a, b) => (a.start_at || '').localeCompare(b.start_at || ''));

                if (sorted.length === 0) {
                    el('diagBookingsList').innerHTML = '<div class="msg-info">予約がありません</div>';
                    return;
                }

                let h = '';
                for (const b of sorted) {
                    const statusCls = (b.status === 'CONFIRMED') ? 'confirmed' : (b.status === 'CHANGED') ? 'changed' : 'canceled';
                    const statusLabel = (b.status === 'CONFIRMED') ? '✅ 確定' : (b.status === 'CHANGED') ? '🔄 変更済' : '❌ キャンセル';
                    h += `<div class="dash-booking">
                        <div class="dash-booking-date">📅 ${fmtDt(b.start_at)} 〜 ${fmtTime(b.end_at)}</div>
                        <div class="dash-booking-info">👤 ${esc(b.customer_name)} 様　<span style="color:#888;font-size:0.78rem">${esc(b.step_type)}</span></div>
                        <div><span class="dash-booking-status ${statusCls}">${statusLabel}</span></div>
                    </div>`;
                }
                el('diagBookingsList').innerHTML = h;
            });
        }

        function doCreateAvail() {
            const dv = el('availDate').value;
            const tv = el('availTime').value;
            const bv = el('availBlocks').value;

            if (!dv || !tv) {
                el('availMsg').innerHTML = '<div class="msg-error">日付と時刻を選択してください</div>'; return;
            }

            el('availMsg').innerHTML = '<div class="loading-text" style="text-align:center;padding:10px">作成中...</div>';
            const repeatWeeks = parseInt(el('availRepeat') ? el('availRepeat').value : '0') || 0;

            callApi('apiDiagCreateAvail', {
                line_user_id: STATE.line_user_id,
                date_ymd: dv,
                start_hhmm: tv,
                blocks: bv,
                repeat_weeks: repeatWeeks,
            }

                , (res) => {
                    if (!res.ok) {
                        el('availMsg').innerHTML = `<div class="msg-error" >${esc(res.error)
                            }

                    </div><button class="btn-retry" onclick="doCreateAvail()" >&#x1f504; 再試行</button>`;
                        return;
                    }

                    const cnt = res.created_count || 1;

                    el('availMsg').innerHTML = `<div class="msg-success" >&#x2705; 稼働枠を${cnt
                        }

                件作成しました</div>`;
                });
        }

        function doListAvail() {
            el('availList').innerHTML = '<div class="loading-text" style="text-align:center;padding:16px"><div class="spinner" style="margin:0 auto 8px"></div>読込中...</div>';

            callApi('apiDiagListAvail', {
                line_user_id: STATE.line_user_id
            }

                , (res) => {
                    if (!res.ok) {
                        el('availList').innerHTML = '<div class="msg-error">' + esc(res.error) + '</div>'; return;
                    }

                    // 稼働枠カレンダーを更新
                    renderAvailCalendar(res.avail);

                    if (res.avail.length === 0) {
                        el('availList').innerHTML = '<div class="msg-info">稼働枠がありません</div>';
                        return;
                    }

                    let h = '';

                    for (const a of res.avail) {
                        h += `<div class="avail-item" > <div class="avail-time" >📅 ${fmtDt(a.start_at)
                            }

                    〜 ${fmtTime(a.end_at)
                            }

                    </div> <button class="btn btn-danger btn-small" onclick="doDeleteAvail('${esc(a.event_id)}')" >削除</button> </div>`;
                    }

                    el('availList').innerHTML = h;
                });
        }

        function doDeleteAvail(eventId) {
            if (!confirm('この稼働枠を削除しますか？')) return;

            callApi('apiDiagDeleteAvail', {
                line_user_id: STATE.line_user_id, event_id: eventId
            }

                , (res) => {
                    if (!res.ok) {
                        showToast(res.error, true); return;
                    }

                    showToast('削除しました');
                    doListAvail();
                });
        }

        /* ========== トースト通知 ========== */
        function showToast(msg, isError = false) {
            const t = document.createElement('div');
            t.textContent = msg;

            Object.assign(t.style, {
                position: 'fixed',
                bottom: '24px',
                left: '50%',
                transform: 'translateX(-50%)',
                background: isError ? '#c62828' : '#2e7d32',
                color: '#fff',
                padding: '12px 20px',
                borderRadius: '24px',
                fontSize: '0.9rem',
                fontWeight: '600',
                zIndex: '9999',
                boxShadow: '0 4px 12px rgba(0,0,0,0.25)',
                maxWidth: '90vw',
                textAlign: 'center',
                transition: 'opacity 0.3s',
            });
            document.body.appendChild(t);

            setTimeout(() => {
                t.style.opacity = '0'; setTimeout(() => t.remove(), 300);
            }

                , 2500);
        }

        /* ========== API呼び出しユーティリティ (fetch版) ========== */
        function callApi(fn, payload, cb) {

            // GAS doPost へ POST する
            // Content-Type: text/plain でCORSプリフライトを回避
            fetch(GAS_URL, {

                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8'
                }

                ,
                body: JSON.stringify({
                    action: fn, payload: payload

                }),
            }).then(function (res) {
                return res.json();

            }).then(function (data) {
                cb(data);

            }).catch(function (err) {
                cb({
                    ok: false, error: String(err)
                });
            });
        }

        /* ========== ヘルパー ========== */
        function el(id) {
            return document.getElementById(id);
        }

        function show(id) {
            const e = el(id); if (e) e.classList.remove('hidden');
        }

        function hide(id) {
            const e = el(id); if (e) e.classList.add('hidden');
        }

        // esc(): DOMを使わない純粋な文字列置換（高速化）
        function esc(s) {
            if (s == null) return '';
            return String(s)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        function fmtDate(d) {
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const dd = String(d.getDate()).padStart(2, '0');

            return y + '-' + m + '-' + dd;
        }

        function fmtDt(iso) {
            const d = new Date(iso);

            return (d.getMonth() + 1) + '/' + d.getDate() + ' ' + String(d.getHours()).padStart(2, '0') + ':' + String(d.getMinutes()).padStart(2, '0');
        }

        function fmtTime(iso) {
            const d = new Date(iso);

            return String(d.getHours()).padStart(2, '0') + ':' + String(d.getMinutes()).padStart(2, '0');
        }

        /* ========== 10. フォントサイズ切替 ========== */
        function toggleFontSize() {
            document.body.classList.toggle('font-lg');
            localStorage.setItem('mytone_font', document.body.classList.contains('font-lg') ? 'lg' : '');
        }

        // 初期化時に復元
        if (localStorage.getItem('mytone_font') === 'lg') document.body.classList.add('font-lg');

        /* ========== 2. フィルタ・ソート ========== */
        let _filterStatus = 'all';
        let _sortAsc = true;
        let _cachedBookings = [];

        function setFilter(status, btn) {
            _filterStatus = status;
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            renderFilteredBookings();
        }

        function toggleSort() {
            _sortAsc = !_sortAsc;
            el('sortBtn').textContent = _sortAsc ? '▲ 日付順' : '▼ 日付逆順';
            renderFilteredBookings();
        }

        function renderFilteredBookings() {
            let list = [..._cachedBookings];
            // ステータスフィルタ
            if (_filterStatus === 'confirmed') list = list.filter(b => b.status === 'CONFIRMED');
            else if (_filterStatus === 'changed') list = list.filter(b => b.status === 'CHANGED');
            else if (_filterStatus === 'canceled') list = list.filter(b => b.status === 'CANCELED');

            // ソート
            list.sort((a, b) => {
                const da = new Date(a.start_at), db = new Date(b.start_at);
                return _sortAsc ? da - db : db - da;
            });
            renderBookingCards(list);
        }

        /* ========== 予約カードレンダリング（共通化） ========== */
        function renderBookingCards(bookings) {
            if (bookings.length === 0) {
                el('bookingsList').innerHTML = '<div class="msg-info">該当する予約がありません</div>';
                return;
            }

            const now = new Date();
            const todayStr = fmtDate(now);
            const tomorrow = new Date(now); tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = fmtDate(tomorrow);
            const weekLater = new Date(now); weekLater.setDate(weekLater.getDate() + 7);
            let h = '';

            for (const b of bookings) {
                const startDate = new Date(b.start_at);
                const startDateStr = fmtDate(startDate);
                let dotCls = 'dot-later', dateCls = 'bi-date-later';

                if (startDateStr === todayStr) {
                    dotCls = 'dot-today'; dateCls = 'bi-date-today';
                }

                else if (startDateStr === tomorrowStr) {
                    dotCls = 'dot-tomorrow'; dateCls = 'bi-date-tomorrow';
                }

                else if (startDate <= weekLater) {
                    dotCls = 'dot-week'; dateCls = 'bi-date-week';
                }

                const step2Btn = b.step_type === 'STEP1' && b.status !== 'CANCELED'
                    ? `<button class="btn btn-outline btn-small" onclick="startStep2FromBooking('${esc(b.booking_id)}','${esc(b.diag_id)}','${esc(b.customer_name)}','${esc(b.customer_phone)}')" >&#x1f504; STEP2予約</button>` : '';
                const reBookBtn = `<button class="btn btn-outline btn-small" onclick="quickRebook('${esc(b.customer_name)}','${esc(b.customer_phone)}','${esc(b.gender || '')}','${esc(b.age || '')}')" >📋 再予約</button>`;

                const memoLine = b.memo ? `<div class="bi-memo" >💬 ${esc(b.memo)
                    }

                </div>` : '';
                const statusBadge = b.status === 'CANCELED' ? ' <span style="color:#e53935;font-size:0.75rem">キャンセル済</span>' : '';
                h += `<div class="booking-item" data-bid="${esc(b.booking_id)}"
                ontouchstart="ctxTouchStart(event,this)" ontouchend="ctxTouchEnd()" ontouchmove="ctxTouchEnd()"

                oncontextmenu="openCtxMenu(event,'${esc(b.booking_id)}','${esc(b.customer_name)}','${esc(b.customer_phone)}','${esc(b.gender || '')}','${esc(b.age || '')}');return false" > <div class="bi-name" >${esc(b.customer_name)
                    }

                <span class="bi-step" >${esc(b.step_type)
                    }

                </span>${statusBadge
                    }

                </div> <div class="bi-sub ${dateCls}" ><span class="urgency-dot ${dotCls}" ></span>📅 ${fmtDt(b.start_at)
                    }

                </div> <div class="bi-sub" >👨‍⚕️ ${esc(b.diag_name)
                    }

                </div> <div class="bi-sub" >📞 ${esc(b.customer_phone)
                    }

                </div> ${memoLine
                    }

                <div class="bi-actions" > <button class="btn btn-secondary btn-small" onclick="openChange('${esc(b.booking_id)}')" >変更</button> <button class="btn btn-danger btn-small" onclick="doCancel('${esc(b.booking_id)}')" >キャンセル</button> ${step2Btn
                    }

                ${reBookBtn
                    }

                </div> </div>`;
            }

            el('bookingsList').innerHTML = h;
        }

        /* ========== 4. クイック再予約 ========== */
        function quickRebook(name, phone, gender, age) {
            // 新規予約タブに切り替え
            switchStaffTab('new');
            startStep('STEP1');

            // 顧客情報を自動入力
            setTimeout(() => {
                el('custName').value = name;
                el('custPhone').value = phone;
                if (gender) el('custGender').value = gender;
                if (age) el('custAge').value = age;
                showToast('顧客情報を引き継ぎました');
            }

                , 100);
        }

        /* ========== 6. 長押しコンテキストメニュー ========== */
        let _ctxTimer = null;

        let _ctxData = {}

            ;

        function ctxTouchStart(e, elem) {
            _ctxTimer = setTimeout(() => {
                const bid = elem.dataset.bid;
                const touch = e.touches[0];
                openCtxMenuAt(touch.clientX, touch.clientY, bid, '', '', '', '');
            }

                , 500);
        }

        function ctxTouchEnd() {
            clearTimeout(_ctxTimer);
        }

        function openCtxMenu(e, bid, name, phone, gender, age) {
            e.preventDefault();

            _ctxData = {
                bid, name, phone, gender, age
            }

                ;
            openCtxMenuAt(e.clientX || e.pageX, e.clientY || e.pageY, bid, name, phone, gender, age);
        }

        function openCtxMenuAt(x, y, bid, name, phone, gender, age) {
            _ctxData = {
                bid, name, phone, gender, age
            }

                ;
            const menu = el('ctxMenu');
            const overlay = el('ctxOverlay');
            // 画面はみ出し防止
            const mw = 200, mh = 220;
            const left = Math.min(x, window.innerWidth - mw);
            const top = Math.min(y, window.innerHeight - mh);
            menu.style.left = left + 'px';
            menu.style.top = top + 'px';
            menu.classList.add('show');
            overlay.classList.add('show');
            if (navigator.vibrate) navigator.vibrate(30);
        }

        function closeCtxMenu() {
            el('ctxMenu').classList.remove('show');
            el('ctxOverlay').classList.remove('show');
        }

        function ctxAction(action) {
            closeCtxMenu();

            switch (action) {
                case 'change': openChange(_ctxData.bid); break;
                case 'cancel': doCancel(_ctxData.bid); break;
                case 'copy': copyId(_ctxData.bid); break;
                case 'rebook': quickRebook(_ctxData.name, _ctxData.phone, _ctxData.gender, _ctxData.age); break;
            }
        }

        /* ========== 11. Confetti アニメーション ========== */
        function showConfetti() {
            const colors = ['#1b5e20', '#4caf50', '#81c784', '#ffeb3b', '#ff9800', '#e91e63', '#2196f3'];
            const container = document.createElement('div');
            container.className = 'confetti-container';

            for (let i = 0; i < 40; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + '%';
                piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = Math.random() * 0.8 + 's';
                piece.style.animationDuration = (1.2 + Math.random() * 1) + 's';
                piece.style.width = (6 + Math.random() * 8) + 'px';
                piece.style.height = (6 + Math.random() * 8) + 'px';
                container.appendChild(piece);
            }

            document.body.appendChild(container);
            setTimeout(() => container.remove(), 3000);
        }

        /* ========== 8. 稼働枠カレンダー表示（診断士側） ========== */
        let _availCalDate = new Date();

        function shiftAvailCalMonth(offset) {
            _availCalDate.setMonth(_availCalDate.getMonth() + offset);
            renderAvailCalendar();
        }

        function renderAvailCalendar(availData) {
            const calGrid = el('availCalGrid');
            const calTitle = el('availCalTitle');
            if (!calGrid || !calTitle) return;

            const year = _availCalDate.getFullYear();
            const month = _availCalDate.getMonth();

            calTitle.textContent = year + '年' + (month + 1) + '月';

            const DOW = ['日', '月', '火', '水', '木', '金', '土'];

            let h = DOW.map(d => '<div class="avail-cal-head">' + d + '</div>').join('');

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const todayStr = fmtDate(new Date());

            // 稼働枠データから日ごとのカウント集計
            const countMap = {}

                ;

            if (availData) {
                for (const a of availData) {
                    const d = a.start_at ? a.start_at.substring(0, 10) : '';
                    if (d) countMap[d] = (countMap[d] || 0) + 1;
                }
            }

            // 空白セル
            for (let i = 0; i < firstDay; i++) h += '<div class="avail-cal-cell"></div>';

            for (let d = 1; d <= daysInMonth; d++) {
                const ymd = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const cnt = countMap[ymd] || 0;
                let cls = 'avail-cal-cell';
                if (cnt > 0) cls += ' has-avail';
                if (ymd === todayStr) cls += ' today';

                h += '<div class="' + cls + '"><div>' + d + '</div>' + (cnt > 0 ? '<div class="ac-count">' + cnt + '枠</div>' : '') + '</div>';
            }

            calGrid.innerHTML = h;
        }

        /* ========== 12. オフライン表示 ========== */
        window.addEventListener('online', () => {
            el('offlineBanner').classList.remove('show');
        });

        window.addEventListener('offline', () => {
            el('offlineBanner').classList.add('show');
            // キャッシュから表示を試みる
            const cached = localStorage.getItem('mytone_bookings_cache');

            if (cached) {
                try {
                    const data = JSON.parse(cached);
                    _cachedBookings = data;
                    renderFilteredBookings();
                }

                catch (e) {
                    /* ignore */
                }
            }
        });

        /* ========== 9. PWA対応 ========== */
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').catch(() => { });
        }

        /* ========== スプラッシュ画面制御 ========== */
        (function initSplash() {
            var splash = document.getElementById('screenSplash');
            if (!splash) return;

            setTimeout(function () {
                splash.classList.add('splash-hiding');

                setTimeout(function () {
                    splash.style.display = 'none';
                }

                    , 600);
            }

                , 1800);
        })();

        /* ========== FABボタン制御 ========== */
        function fabAction() {
            var s = document.getElementById('stepSelect');

            if (s) s.scrollIntoView({
                behavior: 'smooth', block: 'start'
            });
        }

        function updateFabVisibility() {
            var fab = document.getElementById('fabBtn');
            if (!fab) return;
            var staffScreen = document.getElementById('screenStaff');

            if (staffScreen && !staffScreen.classList.contains('hidden')) {
                fab.classList.remove('hidden');
            }

            else {
                fab.classList.add('hidden');
            }
        }

        /* スワイプによる画面遷移は撤廃（誤操作防止のため削除） */

    </script>
    <!--==========FABボタン==========--> <button id="fabBtn" class="fab hidden" onclick="fabAction()" title="new booking"
        aria-label="new booking">&#9988; </button>
    <!-- コンテキストメニュー（長押し用） -->
    <div id="ctxOverlay" class="ctx-overlay" onclick="closeCtxMenu()"></div>
    <div id="ctxMenu" class="ctx-menu"> <button class="ctx-item" onclick="ctxAction('change')">✏️ 変更</button> <button
            class="ctx-item" onclick="ctxAction('copy')">📋 IDコピー</button>
        <button class="ctx-item" onclick="ctxAction('rebook')">🔁
            再予約</button> <button class="ctx-item danger" onclick="ctxAction('cancel')">❌
            キャンセル</button>
    </div>
</body>

</html>
